ace.define("ace/ext/beautify",["require","exports","module","ace/token_iterator"],(function(e,t,r){"use strict";var a=e("../token_iterator").TokenIterator;function o(e,t){return e.type.lastIndexOf(t+".xml")>-1}t.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"],t.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"],t.beautify=function(e){for(var r,s,n,i=new a(e,0,0),c=i.getCurrentToken(),u=e.getTabString(),m=t.singletonTags,l=t.blockTags,p=!1,f=!1,h=!1,b="",d="",g="",y=0,k=0,$=0,x=0,v=0,w=0,T=0,R=0,O=0,q=!1,C=!1,I=!1,_=!1,j={0:0},B=[],F=function(){r&&r.value&&"string.regexp"!==r.type&&(r.value=r.value.trim())},S=function(){b=b.replace(/ +$/,"")},K=function(){b=b.trimRight(),p=!1};null!==c;){if(R=i.getCurrentTokenRow(),r=i.stepForward(),void 0!==c){if(d=c.value,v=0,I="style"===g||"ace/mode/css"===e.$modeId,o(c,"tag-open")?(C=!0,r&&(_=-1!==l.indexOf(r.value)),"</"===d&&(_&&!p&&O<1&&O++,I&&(O=1),v=1,_=!1)):o(c,"tag-close")?C=!1:o(c,"comment.start")?_=!0:o(c,"comment.end")&&(_=!1),C||O||"paren.rparen"!==c.type||"}"!==c.value.substr(0,1)||O++,R!==s&&(O=R,s&&(O-=s)),O){for(K();O>0;O--)b+="\n";p=!0,o(c,"comment")||c.type.match(/^(comment|string)$/)||(d=d.trimLeft())}if(d){if("keyword"===c.type&&d.match(/^(if|else|elseif|for|foreach|while|switch)$/)?(B[y]=d,F(),h=!0,d.match(/^(else|elseif)$/)&&b.match(/\}[\s]*$/)&&(K(),f=!0)):"paren.lparen"===c.type?(F(),"{"===d.substr(-1)&&(h=!0,q=!1,C||(O=1)),"{"===d.substr(0,1)&&(f=!0,"["!==b.substr(-1)&&"["===b.trimRight().substr(-1)?(K(),f=!1):")"===b.trimRight().substr(-1)?K():S())):"paren.rparen"===c.type?(v=1,"}"===d.substr(0,1)&&("case"===B[y-1]&&v++,"{"===b.trimRight().substr(-1)?K():(f=!0,I&&(O+=2))),"]"===d.substr(0,1)&&"}"!==b.substr(-1)&&"}"===b.trimRight().substr(-1)&&(f=!1,x++,K()),")"===d.substr(0,1)&&"("!==b.substr(-1)&&"("===b.trimRight().substr(-1)&&(f=!1,x++,K()),S()):"keyword.operator"!==c.type&&"keyword"!==c.type||!d.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)?"punctuation.operator"===c.type&&";"===d?(K(),F(),h=!0,I&&O++):"punctuation.operator"===c.type&&d.match(/^(:|,)$/)?(K(),F(),d.match(/^(,)$/)&&T>0&&0===w?O++:(h=!0,p=!1)):"support.php_tag"!==c.type||"?>"!==d||p?o(c,"attribute-name")&&b.substr(-1).match(/^\s$/)?f=!0:o(c,"attribute-equals")?(S(),F()):o(c,"tag-close")&&(S(),"/>"===d&&(f=!0)):(K(),f=!0):(K(),F(),f=!0,h=!0),p&&(!c.type.match(/^(comment)$/)||d.substr(0,1).match(/^[/#]$/))&&(!c.type.match(/^(string)$/)||d.substr(0,1).match(/^['"]$/))){if(x=$,y>k)for(x++,n=y;n>k;n--)j[n]=x;else y<k&&(x=j[y]);for(k=y,$=x,v&&(x-=v),q&&!w&&(x++,q=!1),n=0;n<x;n++)b+=u}if("keyword"===c.type&&d.match(/^(case|default)$/)&&(B[y]=d,y++),"keyword"===c.type&&d.match(/^(break)$/)&&B[y-1]&&B[y-1].match(/^(case|default)$/)&&y--,"paren.lparen"===c.type&&(w+=(d.match(/\(/g)||[]).length,T+=(d.match(/\{/g)||[]).length,y+=d.length),"keyword"===c.type&&d.match(/^(if|else|elseif|for|while)$/)?(q=!0,w=0):!w&&d.trim()&&"comment"!==c.type&&(q=!1),"paren.rparen"===c.type)for(w-=(d.match(/\)/g)||[]).length,T-=(d.match(/\}/g)||[]).length,n=0;n<d.length;n++)y--,"}"===d.substr(n,1)&&"case"===B[y]&&y--;f&&!p&&(S(),"\n"!==b.substr(-1)&&(b+=" ")),b+=d,h&&(b+=" "),p=!1,f=!1,h=!1,(o(c,"tag-close")&&(_||-1!==l.indexOf(g))||o(c,"doctype")&&">"===d)&&(O=_&&r&&"</"===r.value?-1:1),o(c,"tag-open")&&"</"===d?y--:o(c,"tag-open")&&"<"===d&&-1===m.indexOf(r.value)?y++:o(c,"tag-name")?g=d:o(c,"tag-close")&&"/>"===d&&-1===m.indexOf(g)&&y--,s=R}}c=r}b=b.trim(),e.doc.setValue(b)},t.commands=[{name:"beautify",description:"Format selection (Beautify)",exec:function(e){t.beautify(e.session)},bindKey:"Ctrl-Shift-B"}]})),ace.require(["ace/ext/beautify"],(function(e){"object"==typeof module&&"object"==typeof exports&&module&&(module.exports=e)}));