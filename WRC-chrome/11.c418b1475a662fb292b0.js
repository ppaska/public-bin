(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"B+Ku":function(e,t,n){"use strict";n.r(t);var i=n("QJY3"),r=n("Valr"),o=n("6onV"),a=n("w1ql"),c=n("hYGK"),s=n("K5td"),l=n("EQPC"),p=n("M0ag"),d=n("AytR"),u=n("mrSG"),f=Object(o.n)("[Code Custom App] load custom apps"),m=Object(o.n)("[Code Custom App] loaded custom apps",Object(o.s)()),b=Object(o.n)("[Code Custom App] load app",Object(o.s)()),v=Object(o.n)("[Code Custom App] load app links"),h=Object(o.n)("[Code Custom App] loaded app",Object(o.s)()),g=Object(o.n)("[Code Custom App] save app link",Object(o.s)()),j=Object(o.n)("[Code Custom App] saved app link",Object(o.s)()),y=Object(o.n)("[Code Custom App] delete app links",Object(o.s)()),x=(Object(o.u)({loadApps:f,loadedApps:m,loadApp:b,loadedApp:h,deleteAppLinks:y,savedAppLink:j,loadAppLinks:v}),Object(o.n)("[Code Tabs] close all tabs")),w=Object(o.n)("[Code Tabs] open link",Object(o.s)()),O=Object(o.n)("[Code Tabs] close tab",Object(o.s)()),C=Object(o.n)("[Code Tabs] changed app content",Object(o.s)()),S=(Object(o.n)("[Code Tabs] changed table",Object(o.s)()),Object(o.n)("[Code Tabs] changed view",Object(o.s)())),I=Object(o.n)("[Code Tabs] save app contents"),E=Object(o.n)("[Code Tabs] save connection tables"),k=Object(o.n)("[Code Tabs] saved app changes"),N=Object(o.n)("[Code Tabs] saved db objects",Object(o.s)()),T=Object(o.n)("[Code Tabs] deleted db object",Object(o.s)()),M=(Object(o.u)({openTab:w,closeTab:O,savedAppTabs:k,savedDbObjects:N}),Object(o.n)("[Code Tabs] load connections")),P=Object(o.n)("[Code Tabs] loaded connections",Object(o.s)()),A={active:void 0,list:void 0,loading:!1,appLoading:!1},D=Object(o.p)(A,Object(o.r)(f,(function(e){return Object(u.a)(Object(u.a)({},e),{loading:!0})})),Object(o.r)(m,(function(e,t){var n=t.apps;return Object(u.a)(Object(u.a)({},e),{list:n,loading:!1})})),Object(o.r)(b,(function(e,t){var n=t.app;return Object(u.a)(Object(u.a)({},e),{appLoading:Boolean(n),active:n?e.active:null})})),Object(o.r)(h,(function(e,t){var n=t.app,i=t.links;return Object(u.a)(Object(u.a)({},e),{appLoading:!1,active:{app:n,links:i,linksToSave:null}})})),Object(o.r)(j,(function(e,t){var n=t.link;return n&&(e.active.links=Object(u.i)(e.active.links,[n])),Object(u.a)({},e)})));function F(e,t){if(e.contentId)return e.contentId===t.contentId;var n=function(e){return e.folder+e.name+e.contentType};return n(e)===n(t)}function V(e,t){return e.connectionName+"/"+t.schemaName+"/"+t.objectName+"."+t.objectType}var _={active:null,list:[],contentToSave:null,objectsToSave:{}},L=Object(o.p)(_,Object(o.r)(w,(function(e,t){var n=t.info,i=t.app,r=t.tabType,o=e.list.find((function(e){return e.info===n}));if(o===e.active)return e;if(o)return Object(u.a)(Object(u.a)({},e),{active:o});var a={info:n,app:i,tabType:r};return Object(u.a)(Object(u.a)({},e),{list:Object(u.i)(e.list,[a]),active:a})})),Object(o.r)(O,(function(e,t){var n,i=t.links,r=e.list.filter((function(e){return!i.includes(e.info)})),o=e.active;return r.length&&i.includes(null===(n=e.active)||void 0===n?void 0:n.info)&&(o=r[0]),Object(u.a)(Object(u.a)({},e),{active:o,list:r})})),Object(o.r)(x,(function(e){return Object(u.a)(Object(u.a)({},e),{list:[],contentToSave:null})})),Object(o.r)(C,(function(e,t){var n=t.link,i=n.content,r=Object(u.i)(e.contentToSave||[]),o=r.find((function(e){return F(e,n)}));return"string"==typeof i?o?o.content=i:r.push(Object(u.a)({},n)):null===i&&o&&(r=r.filter((function(e){return!F(e,n)}))),Object(u.a)(Object(u.a)({},e),{contentToSave:r})})),Object(o.r)(k,(function(e){return Object(u.a)(Object(u.a)({},e),{contentToSave:null})})),Object(o.r)(N,(function(e){return Object(u.a)(Object(u.a)({},e),{objectsToSave:{}})})),Object(o.r)(S,(function(e,t){var n=t.key,i=t.data;return i?e.objectsToSave[n]=i:delete e.objectsToSave[n],Object(u.a)(Object(u.a)({},e),{objectsToSave:Object(u.a)({},e.objectsToSave)})}))),$={customApp:function(e,t){return void 0===e&&(e=A),D(e,t)},tabs:function(e,t){return void 0===e&&(e=_),L(e,t)},connections:Object(o.p)([],Object(o.r)(P,(function(e,t){return t.connections})))},q=[],R=n("F/XL"),Q=n("VNr4"),B=n("XlPw"),G=n("G5J1"),z=n("15JJ"),W=n("67Y/"),U=n("9Z1F"),H=n("VnD/"),J=n("/PH2"),Y=n("psW0"),K=n("ZF+8"),X=n("0CDM"),Z=n("TwVa"),ee=Object(o.o)("customApp"),te=Object(o.q)(ee,(function(e){return e.list})),ne=Object(o.q)(ee,(function(e){return e.active})),ie=Object(o.q)(ee,(function(e){var t;return null===(t=e.active)||void 0===t?void 0:t.app})),re=Object(o.q)(ee,(function(e){var t;return null===(t=e.active)||void 0===t?void 0:t.links})),oe=Object(o.o)("tabs"),ae=Object(o.q)(oe,(function(e){return e.list})),ce=Object(o.q)(oe,(function(e){return e.active})),se=Object(o.q)(oe,(function(e){return e.contentToSave})),le=Object(o.q)(oe,(function(e){return e.objectsToSave})),pe=Object(o.q)(oe,(function(e){var t;return!!((null===(t=e.contentToSave)||void 0===t?void 0:t.length)||Object.keys(e.objectsToSave).length)})),de=function(e){return e.connections},ue=function(e){return e.APP="Application",e.DB="DataBase",e.SQLQuery="SQLQuery",e}({}),fe=n("TYT/"),me=function(){function e(e,t,n,i){var r=this;this.actions$=e,this.appService=t,this.notificationService=n,this.store=i,this.loadApps$=Object(a.d)((function(){return r.actions$.pipe(Object(a.e)(f),Object(z.a)((function(){return r.appService.loadMyApps()})),Object(W.a)((function(e){return m({apps:e})})),Object(U.a)((function(e){return r.notificationService.open({type:Z.f.DANGER,message:e.error||"Failed to load apps list."}),Object(R.a)(m({apps:[]}))})))})),this.loadApp$=Object(a.d)((function(){return r.actions$.pipe(Object(a.e)(b),Object(H.a)((function(e){return Boolean(e)})),Object(z.a)((function(e){var t=e.app;return Object(Q.a)([r.appService.getAppInfo(t.ownerName,t.appName).pipe(Object(U.a)((function(e){return Object(B.a)(e)}))),r.appService.getAllLinks(t.ownerName,t.appName).pipe(Object(U.a)((function(e){return Object(B.a)(e)})))]).pipe(Object(W.a)((function(e){return h({app:e[0],links:e[1]})})),Object(U.a)((function(e){return r.notificationService.open({type:Z.f.DANGER,message:e.error||"Failed to load app info."}),Object(R.a)(h({app:null,links:[]}))})))})))})),this.loadAppLinks$=Object(a.d)((function(){return r.actions$.pipe(Object(a.e)(v),Object(J.a)(r.store.select(ne)),Object(z.a)((function(e){var t=e[1].app;return r.appService.getAllLinks(t.ownerName,t.appName).pipe(Object(W.a)((function(e){return h({app:t,links:e})})),Object(U.a)((function(e){return Object(R.a)(h({app:null,links:[]}))})))})))})),this.deleteAppLinks$=Object(a.d)((function(){return r.actions$.pipe(Object(a.e)(y),Object(J.a)(r.store.select(ne)),Object(z.a)((function(e){var t=e[1].app,n=e[0].links.filter((function(e){return e.contentId}));return n.length?Object(Q.a)(n.map((function(e){return r.appService.deleteAppContent({appName:t.appName,appOwnerName:t.ownerName,appContent:e})}))).pipe(Object(W.a)((function(){return r.notificationService.open({type:Z.f.SUCCESS,message:"Deleted content."}),{type:"[Code Custom App] deleted app content"}})),Object(U.a)((function(e){return r.notificationService.open({type:Z.f.DANGER,message:e.error||"Failed to delete content."}),Object(R.a)(v())}))):G.a})))})),this.saveAppContent$=Object(a.d)((function(){return r.actions$.pipe(Object(a.e)(g),Object(J.a)(r.store.select(ne)),Object(Y.a)((function(e){var t=e[0].link,n=e[1].app;return r.appService.saveAppLink({appOwnerName:n.ownerName,appName:n.appName,appContent:t}).pipe(Object(z.a)((function(e){return t.contentId?[j(null)]:(t.contentId=e,[j({link:t}),w({info:t,app:n,tabType:ue.APP})])})),Object(U.a)((function(e){return r.notificationService.open({type:Z.f.DANGER,message:e.error||"Failed to save app content."}),Object(R.a)({type:"[Code Custom App 0] failed to save app content"})})))})))}))}return e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275inject"](a.a),fe["\u0275\u0275inject"](X.a),fe["\u0275\u0275inject"](K.e),fe["\u0275\u0275inject"](o.h))},e.\u0275prov=fe["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e}(),be=n("DUip"),ve=n("JGTj"),he=n("Xn/w"),ge=n("oW1M"),je=n("Gi3i"),ye=n("5sEi"),xe=n("cSvJ"),we=n("xMyE"),Oe=n("bne5"),Ce=n("ad02"),Se=n("bU/s"),Ie=n("iFvM"),Ee=n("UShy"),ke=n("t3T2"),Ne=n("iMDe"),Te=n("iMra"),Me=n("0yZh"),Pe=n("ZZj6"),Ae=n("b8dF");function De(e,t){if(1&e&&(fe["\u0275\u0275elementStart"](0,"span",7),fe["\u0275\u0275text"](1),fe["\u0275\u0275elementEnd"]()),2&e){var n=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](1),fe["\u0275\u0275textInterpolate1"]("",n.evaluationTime/1e3," s")}}function Fe(e,t){1&e&&fe["\u0275\u0275element"](0,"app-assertion-logs",8),2&e&&fe["\u0275\u0275property"]("assertions",t.ngIf.asserts)}function Ve(e,t){if(1&e&&(fe["\u0275\u0275elementStart"](0,"p",14),fe["\u0275\u0275text"](1),fe["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;fe["\u0275\u0275advance"](1),fe["\u0275\u0275textInterpolate"](n)}}function _e(e,t){if(1&e&&(fe["\u0275\u0275elementStart"](0,"alert",12),fe["\u0275\u0275text"](1,"\n        "),fe["\u0275\u0275elementStart"](2,"strong"),fe["\u0275\u0275text"](3,"Runtime Error:"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](4,"\n        "),fe["\u0275\u0275template"](5,Ve,2,1,"p",13),fe["\u0275\u0275text"](6,"\n      "),fe["\u0275\u0275elementEnd"]()),2&e){var n=fe["\u0275\u0275nextContext"]().ngIf;fe["\u0275\u0275advance"](5),fe["\u0275\u0275property"]("ngForOf",n.errors)}}function Le(e,t){if(1&e&&(fe["\u0275\u0275elementContainerStart"](0),fe["\u0275\u0275text"](1,"\n      "),fe["\u0275\u0275template"](2,_e,7,1,"alert",9),fe["\u0275\u0275text"](3,"\n      "),fe["\u0275\u0275element"](4,"app-show-in-presenter",10,11),fe["\u0275\u0275text"](6,"\n    "),fe["\u0275\u0275elementContainerEnd"]()),2&e){var n=t.ngIf;fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",n.errors&&n.errors.length),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("items",n.showInItems)}}var $e=function(){function e(){this.display="none"}return e.prototype.ngOnChanges=function(){this.display=this.isEmpty()?"none":"block"},e.prototype.isEmpty=function(){return!(this.scriptContext.asserts.length||this.scriptContext.errors.length||this.scriptContext.showInItems.length)},e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:e,selectors:[["app-jspy-result"]],hostVars:2,hostBindings:function(e,t){2&e&&fe["\u0275\u0275styleProp"]("display",t.display)},inputs:{scriptContext:"scriptContext",evaluationTime:"evaluationTime"},features:[fe["\u0275\u0275NgOnChangesFeature"]()],decls:18,vars:3,consts:[[1,"card","overflow-hidden","mb-0","w-100","h-100"],[1,"card-header","d-flex","py-2","px-2"],[1,"row","w-100","ml-0","align-items-center"],["class","badge badge-info ml-2 p-1",4,"ngIf"],["class","ml-auto",3,"assertions",4,"ngIf"],[1,"card-body","overflow-hidden","d-flex","p-2","flex-column","h-100"],[4,"ngIf"],[1,"badge","badge-info","ml-2","p-1"],[1,"ml-auto",3,"assertions"],["type","danger",4,"ngIf"],[1,"h-100",3,"items"],["showIn",""],["type","danger"],["class","mb-0",4,"ngFor","ngForOf"],[1,"mb-0"]],template:function(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",0),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275elementStart"](2,"div",1),fe["\u0275\u0275text"](3,"\n    "),fe["\u0275\u0275elementStart"](4,"div",2),fe["\u0275\u0275text"](5,"\n      Result\n      "),fe["\u0275\u0275template"](6,De,2,1,"span",3),fe["\u0275\u0275text"](7,"\n      "),fe["\u0275\u0275template"](8,Fe,1,1,"app-assertion-logs",4),fe["\u0275\u0275text"](9,"\n    "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](10,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](11,"\n  "),fe["\u0275\u0275elementStart"](12,"div",5),fe["\u0275\u0275text"](13,"\n    "),fe["\u0275\u0275template"](14,Le,7,2,"ng-container",6),fe["\u0275\u0275text"](15,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](16,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](17,"\n")),2&e&&(fe["\u0275\u0275advance"](6),fe["\u0275\u0275property"]("ngIf",t.evaluationTime),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",t.scriptContext),fe["\u0275\u0275advance"](6),fe["\u0275\u0275property"]("ngIf",t.scriptContext))},directives:[r.NgIf,Me.a,Pe.a,Ae.a,r.NgForOf],styles:[""]}),e}(),qe=["scriptsEl"];function Re(e,t){if(1&e&&(fe["\u0275\u0275elementStart"](0,"option",14),fe["\u0275\u0275text"](1),fe["\u0275\u0275elementEnd"]()),2&e){var n=t.$implicit;fe["\u0275\u0275property"]("value",n),fe["\u0275\u0275advance"](1),fe["\u0275\u0275textInterpolate"](n)}}function Qe(e,t){1&e&&fe["\u0275\u0275element"](0,"i",15)}function Be(e,t){1&e&&fe["\u0275\u0275element"](0,"i",16)}function Ge(e,t){if(1&e&&(fe["\u0275\u0275elementStart"](0,"alert",17),fe["\u0275\u0275text"](1),fe["\u0275\u0275elementEnd"]()),2&e){var n=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](1),fe["\u0275\u0275textInterpolate"](n.error)}}function ze(e,t){if(1&e&&(fe["\u0275\u0275elementStart"](0,"alert",18),fe["\u0275\u0275text"](1),fe["\u0275\u0275elementEnd"]()),2&e){var n=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](1),fe["\u0275\u0275textInterpolate"](n.success)}}function We(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",19),fe["\u0275\u0275text"](1,"\n    "),fe["\u0275\u0275elementStart"](2,"div",20),fe["\u0275\u0275text"](3,"\n      "),fe["\u0275\u0275elementStart"](4,"span",21),fe["\u0275\u0275text"](5,"Loading..."),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](6,"\n    "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](7,"\n  "),fe["\u0275\u0275elementEnd"]())}var Ue=function(){function e(e,t){this.dialogService=e,this.appApiService=t,this.functionsChange=new fe.EventEmitter,this.scriptChange=new fe.EventEmitter,this.functions=[],this.loading=!1,this.interpreter=Object(Ee.a)(),this.restInterpreter=new ke.a(this.dialogService)}return e.prototype.ngOnInit=function(){var e=this;this.scriptsEditor=Object(Se.edit)(this.scriptsEl.nativeElement,{mode:"ace/mode/python",autoScrollEditorIntoView:!0,tabSize:2,useSoftTabs:!0,indentedSoftWrap:!0,theme:Object(Ie.i)(),value:this.scripts||""}),this.scriptsEditor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!1,enableLiveAutocompletion:!0}),Object(Oe.a)(this.scriptsEditor,"change").pipe(Object(je.a)(500),Object(we.a)((function(){e.resetState(),e.scriptChange.emit(e.scriptsEditor.getValue())})),Object(W.a)((function(){return e.getFuncs()}),Object(Ce.a)())).subscribe((function(t){e.functions=t,e.functionsChange.emit(t)}))},e.prototype.ngOnChanges=function(e){var t=e.scripts;t.firstChange||t.currentValue===t.previousValue||(this.scriptsEditor.setValue(t.currentValue||"",-1),this.restInterpreter.reset())},e.prototype.getValue=function(){return this.scriptsEditor.getValue()},e.prototype.testFunction=function(){return Object(u.b)(this,void 0,void 0,(function(){var e,t,n,i,r=this;return Object(u.e)(this,(function(o){switch(o.label){case 0:if(this.resetState(),this.loading=!0,e=this.scriptsEditor.getValue(),!this.interpreter.hasFunction(e,this.selectedFunction))return[3,5];o.label=1;case 1:return o.trys.push([1,3,4,5]),this.evaluationTime=null,this.restInterpreter.reset(),t=(new Date).getTime(),[4,this.restInterpreter.evaluate(e,Object(u.a)({},this.context),this.selectedFunction)];case 2:return void 0!==(n=o.sent())&&(this.restInterpreter.scriptContext.showInItems=Object(u.i)(this.restInterpreter.scriptContext.showInItems,[{type:Ne.c.ObjectExplorer,title:"Return Value",data:n}])),this.evaluationTime=+new Date-t,this.success="Function "+this.selectedFunction+" evaluated successfully",[3,5];case 3:return i=o.sent(),this.error=i,[3,5];case 4:return this.loading=!1,window.requestAnimationFrame((function(){r.scriptsEditor.resize()})),[7];case 5:return[2]}}))}))},e.prototype.resetState=function(){this.error=null,this.success=null},e.prototype.getFuncs=function(){var e=this.scriptsEditor.getValue();if(e)return e.split("\n").map((function(e){var t=e.match(/(def\s)(.*)(\(\)):/);if(t)return t[2].replace(/ /g,"")})).filter((function(e){return Boolean(e)}))},e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275directiveInject"](K.b),fe["\u0275\u0275directiveInject"](Te.a))},e.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:e,selectors:[["app-jspy-script"]],viewQuery:function(e,t){var n;1&e&&fe["\u0275\u0275staticViewQuery"](qe,!0),2&e&&fe["\u0275\u0275queryRefresh"](n=fe["\u0275\u0275loadQuery"]())&&(t.scriptsEl=n.first)},inputs:{context:"context",scripts:"scripts"},outputs:{functionsChange:"functionsChange",scriptChange:"scriptChange"},features:[fe["\u0275\u0275NgOnChangesFeature"]()],decls:32,vars:11,consts:[[1,"d-flex","h-100","flex-column"],[1,"form-group","row"],["for","jspy-functions",1,"col-form-label","col-auto"],["id","jspy-functions","name","jspy-functions",1,"form-control","col-3",3,"disabled","ngModel","change","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"btn","btn-primary","mx-2","align-self-baseline",3,"disabled","click"],["class","fa fa-spinner",4,"ngIf"],["class","fa fa-play",4,"ngIf"],["type","danger",4,"ngIf"],["type","success",4,"ngIf"],[1,"flex-fill"],["scriptsEl",""],[1,"h-50","mt-1",3,"scriptContext","evaluationTime"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner",4,"ngIf"],[3,"value"],[1,"fa","fa-spinner"],[1,"fa","fa-play"],["type","danger"],["type","success"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",0),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275elementStart"](2,"div",1),fe["\u0275\u0275text"](3,"\n    "),fe["\u0275\u0275elementStart"](4,"label",2),fe["\u0275\u0275text"](5,"Functions"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](6,"\n    "),fe["\u0275\u0275elementStart"](7,"select",3),fe["\u0275\u0275listener"]("change",(function(){return t.resetState()}))("ngModelChange",(function(e){return t.selectedFunction=e})),fe["\u0275\u0275text"](8,"\n      "),fe["\u0275\u0275template"](9,Re,2,2,"option",4),fe["\u0275\u0275text"](10,"\n    "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](11,"\n    "),fe["\u0275\u0275elementStart"](12,"button",5),fe["\u0275\u0275listener"]("click",(function(){return t.testFunction()})),fe["\u0275\u0275text"](13,"\n      "),fe["\u0275\u0275template"](14,Qe,1,0,"i",6),fe["\u0275\u0275text"](15,"\n      "),fe["\u0275\u0275template"](16,Be,1,0,"i",7),fe["\u0275\u0275text"](17,"\n       Test\n    "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](18,"\n    "),fe["\u0275\u0275template"](19,Ge,2,1,"alert",8),fe["\u0275\u0275text"](20,"\n    "),fe["\u0275\u0275template"](21,ze,2,1,"alert",9),fe["\u0275\u0275text"](22,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](23,"\n  "),fe["\u0275\u0275element"](24,"div",10,11),fe["\u0275\u0275text"](26,"\n  "),fe["\u0275\u0275element"](27,"app-jspy-result",12),fe["\u0275\u0275text"](28,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](29,"\n"),fe["\u0275\u0275template"](30,We,8,0,"div",13),fe["\u0275\u0275text"](31,"\n")),2&e&&(fe["\u0275\u0275advance"](7),fe["\u0275\u0275property"]("disabled",!(t.functions&&t.functions.length))("ngModel",t.selectedFunction),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngForOf",t.functions),fe["\u0275\u0275advance"](3),fe["\u0275\u0275property"]("disabled",!t.selectedFunction||t.loading),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",t.loading),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",!t.loading),fe["\u0275\u0275advance"](3),fe["\u0275\u0275property"]("ngIf",t.error),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",t.success),fe["\u0275\u0275advance"](6),fe["\u0275\u0275property"]("scriptContext",t.restInterpreter.scriptContext)("evaluationTime",t.evaluationTime),fe["\u0275\u0275advance"](3),fe["\u0275\u0275property"]("ngIf",t.loading))},directives:[i.SelectControlValueAccessor,i.NgControlStatus,i.NgModel,r.NgForOf,r.NgIf,$e,i.NgSelectOption,i["\u0275angular_packages_forms_forms_x"],Ae.a],styles:["alert[_ngcontent-%COMP%]     .alert{padding-top:.5rem;padding-bottom:.5rem;margin-bottom:0;border:none}"]}),e}();function He(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",4),fe["\u0275\u0275text"](1,"\n    "),fe["\u0275\u0275elementStart"](2,"div",5),fe["\u0275\u0275elementStart"](3,"span",6),fe["\u0275\u0275text"](4,"Loading..."),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](5,"\n  "),fe["\u0275\u0275elementEnd"]())}function Je(e,t){if(1&e){var n=fe["\u0275\u0275getCurrentView"]();fe["\u0275\u0275elementContainerStart"](0),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275elementStart"](2,"app-jspy-script",2),fe["\u0275\u0275listener"]("scriptChange",(function(e){return fe["\u0275\u0275restoreView"](n),fe["\u0275\u0275nextContext"]().onChange(e)})),fe["\u0275\u0275pipe"](3,"async"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](4,"\n  "),fe["\u0275\u0275template"](5,He,6,0,"div",3),fe["\u0275\u0275text"](6,"\n"),fe["\u0275\u0275elementContainerEnd"]()}if(2&e){var i=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("scripts",fe["\u0275\u0275pipeBind1"](3,2,i.content$)),fe["\u0275\u0275advance"](3),fe["\u0275\u0275property"]("ngIf",i.loading)}}function Ye(e,t){if(1&e&&(fe["\u0275\u0275text"](0,"\n  "),fe["\u0275\u0275elementStart"](1,"alert",7),fe["\u0275\u0275text"](2,"\n    "),fe["\u0275\u0275elementStart"](3,"strong"),fe["\u0275\u0275text"](4,"Error: "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](5),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](6,"\n")),2&e){var n=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](5),fe["\u0275\u0275textInterpolate1"]("",n.error,"\n  ")}}var Ke=function(){function e(e,t){this.store=e,this.appService=t,this.loading=!1,this.error=null,this.pos=!0}return e.prototype.ngOnInit=function(){var e=this,t=this.tabData.info,n={appName:this.tabData.app.appName,appOwnerName:this.tabData.app.ownerName,folder:t.folder,name:t.name,contentType:t.contentType};this.loading=!0,this.content$=this.store.select(ce).pipe(Object(H.a)((function(t){return t.info===e.tabData.info})),Object(z.a)((function(){return e.appService.getAppContent(n).pipe(Object(W.a)((function(e){if(!e)throw Error("No content for requested file "+Object(ye.b)(n));return e.content})),Object(we.a)((function(t){e.content=t,e.loading=!1})),Object(U.a)((function(t){return e.error=Object(p.i)(t,"Failed to load file "+Object(ye.b)(n)),e.loading=!1,G.a})))})))},e.prototype.onChange=function(e){this.store.dispatch(C({link:Object(u.a)(Object(u.a)({},this.tabData.info),{content:e===this.content?null:e})}))},e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275directiveInject"](o.h),fe["\u0275\u0275directiveInject"](X.a))},e.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:e,selectors:[["app-tab-jspy"]],hostVars:2,hostBindings:function(e,t){2&e&&fe["\u0275\u0275classProp"]("position-relative",t.pos)},inputs:{tabData:"tabData"},decls:5,vars:2,consts:[[4,"ngIf","ngIfElse"],["errorTmpl",""],[1,"h-100","w-100",3,"scripts","scriptChange"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner"],["role","status",1,"spinner-border"],[1,"sr-only"],["type","danger"]],template:function(e,t){if(1&e&&(fe["\u0275\u0275template"](0,Je,7,4,"ng-container",0),fe["\u0275\u0275text"](1,"\n\n"),fe["\u0275\u0275template"](2,Ye,7,1,"ng-template",null,1,fe["\u0275\u0275templateRefExtractor"]),fe["\u0275\u0275text"](4,"\n\n")),2&e){var n=fe["\u0275\u0275reference"](3);fe["\u0275\u0275property"]("ngIf",!t.error)("ngIfElse",n)}},directives:[r.NgIf,Ue,Ae.a],pipes:[r.AsyncPipe],styles:[".spinner[_ngcontent-%COMP%]{left:0}"]}),e}(),Xe=n("Czp8"),Ze=n("Yh5v"),et=n("dv3C"),tt=["uiModelEl"];function nt(e,t){if(1&e&&(fe["\u0275\u0275elementStart"](0,"alert",17),fe["\u0275\u0275text"](1,"\n        "),fe["\u0275\u0275elementStart"](2,"strong"),fe["\u0275\u0275text"](3,"Error:"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](4),fe["\u0275\u0275elementEnd"]()),2&e){var n=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](4),fe["\u0275\u0275textInterpolate1"](" ",n.error,"\n      ")}}function it(e,t){if(1&e&&fe["\u0275\u0275element"](0,"app-page",18),2&e){var n=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275property"]("queryParams",n.queryParams)("pageContent",n.pageContent)}}function rt(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",19),fe["\u0275\u0275text"](1,"\n        "),fe["\u0275\u0275elementStart"](2,"div",20),fe["\u0275\u0275text"](3,"\n          "),fe["\u0275\u0275elementStart"](4,"span",21),fe["\u0275\u0275text"](5,"Loading..."),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](6,"\n        "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](7,"\n      "),fe["\u0275\u0275elementEnd"]())}var ot=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.LOCAL_QUERY_STRING_NAMESPACE="code-query-strings",t}return Object(u.d)(t,e),t.prototype.ngOnInit=function(){this.initQueryString(),e.prototype.ngOnInit.call(this)},t.prototype.ngAfterViewInit=function(){var e=this;this.interpretator=Object(Ee.a)(),this.uiModelEditor=Object(Se.edit)(this.uiModelEl.nativeElement,{mode:"ace/mode/xml",autoScrollEditorIntoView:!0,tabSize:2,useSoftTabs:!0,indentedSoftWrap:!0,theme:Object(p.g)()}),this.content$.subscribe((function(t){return e.uiModelEditor.setValue(t||"",-1)})),Object(Oe.a)(this.uiModelEditor,"change").pipe(Object(je.a)(500)).subscribe((function(){return e.onChange(e.uiModelEditor.getValue())}))},t.prototype.onReload=function(){return Object(u.b)(this,void 0,void 0,(function(){var e,t,n;return Object(u.e)(this,(function(i){switch(i.label){case 0:this.loading=!0,this.pageContent=null,this.error=null,i.label=1;case 1:return i.trys.push([1,5,6,7]),this.queryParams=Object(p.k)(null,this.queryString),e={pageContentId:null,pageContent:this.uiModelEditor.getValue()},[4,this.appService.getPageDesignScript(e).toPromise()];case 2:return(t=i.sent())?[4,this.interpretator.evaluate(t,{session:Xe.a.contextVariables,app:Xe.a.variables,mockObject:function(e,t){Object.entries(t).forEach((function(t){var n=t[0],i=t[1];Object(Ee.c)(e,n,i)}))}},"beforeReload")]:[3,4];case 3:i.sent(),i.label=4;case 4:return this.pageContent=e,[3,7];case 5:return n=i.sent(),this.error=Object(p.i)(n),[3,7];case 6:return this.loading=!1,Xe.a.setVariable(Object(ye.b)(this.tabData.info),this.queryString,this.LOCAL_QUERY_STRING_NAMESPACE),this.tabData.info.queryString=this.queryString,[7];case 7:return[2]}}))}))},t.prototype.initQueryString=function(){var e=Xe.a.variables[this.LOCAL_QUERY_STRING_NAMESPACE];e&&(this.queryString=e[Object(ye.b)(this.tabData.info)]||null,this.tabData.info.queryString=this.queryString)},t.\u0275fac=function(e){return at(e||t)},t.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:t,selectors:[["app-tab-page"]],viewQuery:function(e,t){var n;1&e&&fe["\u0275\u0275viewQuery"](tt,!0),2&e&&fe["\u0275\u0275queryRefresh"](n=fe["\u0275\u0275loadQuery"]())&&(t.uiModelEl=n.first)},features:[fe["\u0275\u0275InheritDefinitionFeature"]],decls:42,vars:5,consts:[[1,"row","m-0","mb-2"],[1,"mb-0","align-self-center"],["for","querySring",1,"col-form-label","ml-auto"],["type","text","id","querySring","placeholder","param=val&param2=val2",1,"form-control","w-auto","mx-2",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-primary","mr-1",3,"click"],[1,"h-100","overflow-hidden"],["left","",1,"w-100"],["uiModelEl",""],["right",""],[1,"position-relative","h-100"],["type","danger",4,"ngIf"],[3,"queryParams","pageContent",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],["left-label",""],[1,"fa","fa-code","fa-lg"],["right-label",""],[1,"fa","fa-picture-o","fa-lg"],["type","danger"],[3,"queryParams","pageContent"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",0),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275elementStart"](2,"h5",1),fe["\u0275\u0275text"](3),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](4,"\n  "),fe["\u0275\u0275elementStart"](5,"label",2),fe["\u0275\u0275text"](6,"Query string"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](7,"\n    "),fe["\u0275\u0275elementStart"](8,"input",3),fe["\u0275\u0275listener"]("ngModelChange",(function(e){return t.queryString=e})),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](9,"\n    "),fe["\u0275\u0275elementStart"](10,"button",4),fe["\u0275\u0275listener"]("click",(function(){return t.onReload()})),fe["\u0275\u0275text"](11,"Reload"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](12,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](13,"\n"),fe["\u0275\u0275elementStart"](14,"app-split-content",5),fe["\u0275\u0275text"](15,"\n  "),fe["\u0275\u0275element"](16,"div",6,7),fe["\u0275\u0275text"](18,"\n  "),fe["\u0275\u0275elementContainerStart"](19,8),fe["\u0275\u0275text"](20,"\n    "),fe["\u0275\u0275elementStart"](21,"div",9),fe["\u0275\u0275text"](22,"\n      "),fe["\u0275\u0275template"](23,nt,5,1,"alert",10),fe["\u0275\u0275text"](24,"\n      "),fe["\u0275\u0275template"](25,it,1,2,"app-page",11),fe["\u0275\u0275text"](26,"\n      "),fe["\u0275\u0275template"](27,rt,8,0,"div",12),fe["\u0275\u0275text"](28,"\n    "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](29,"\n  "),fe["\u0275\u0275elementContainerEnd"](),fe["\u0275\u0275text"](30,"\n  "),fe["\u0275\u0275elementContainerStart"](31,13),fe["\u0275\u0275text"](32,"\n    "),fe["\u0275\u0275element"](33,"i",14),fe["\u0275\u0275text"](34," Code\n  "),fe["\u0275\u0275elementContainerEnd"](),fe["\u0275\u0275text"](35,"\n  "),fe["\u0275\u0275elementContainerStart"](36,15),fe["\u0275\u0275text"](37,"\n    "),fe["\u0275\u0275element"](38,"i",16),fe["\u0275\u0275text"](39," Preview\n  "),fe["\u0275\u0275elementContainerEnd"](),fe["\u0275\u0275text"](40,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](41,"\n")),2&e&&(fe["\u0275\u0275advance"](3),fe["\u0275\u0275textInterpolate"](t.tabData.info.name),fe["\u0275\u0275advance"](5),fe["\u0275\u0275property"]("ngModel",t.queryString),fe["\u0275\u0275advance"](15),fe["\u0275\u0275property"]("ngIf",t.error),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",t.pageContent),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",t.loading))},directives:[i.DefaultValueAccessor,i.NgControlStatus,i.NgModel,Ze.a,r.NgIf,Ae.a,et.a],styles:["[_nghost-%COMP%]{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;height:100%}"]}),t}(Ke),at=fe["\u0275\u0275getInheritedFactory"](ot),ct=["uiModelEl"];function st(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",5),fe["\u0275\u0275text"](1,"\n    "),fe["\u0275\u0275elementStart"](2,"div",6),fe["\u0275\u0275elementStart"](3,"span",7),fe["\u0275\u0275text"](4,"Loading..."),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](5,"\n  "),fe["\u0275\u0275elementEnd"]())}function lt(e,t){if(1&e&&(fe["\u0275\u0275elementContainerStart"](0),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275element"](2,"div",2,3),fe["\u0275\u0275text"](4,"\n  "),fe["\u0275\u0275template"](5,st,6,0,"div",4),fe["\u0275\u0275text"](6,"\n"),fe["\u0275\u0275elementContainerEnd"]()),2&e){var n=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](5),fe["\u0275\u0275property"]("ngIf",n.loading)}}function pt(e,t){if(1&e&&(fe["\u0275\u0275text"](0,"\n  "),fe["\u0275\u0275elementStart"](1,"alert",8),fe["\u0275\u0275text"](2,"\n    "),fe["\u0275\u0275elementStart"](3,"strong"),fe["\u0275\u0275text"](4,"Error: "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](5),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](6,"\n")),2&e){var n=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](5),fe["\u0275\u0275textInterpolate1"]("",n.error,"\n  ")}}var dt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(u.d)(t,e),t.prototype.ngAfterViewInit=function(){var e=this;this.uiModelEditor=Object(Se.edit)(this.uiModelEl.nativeElement,{mode:"ace/mode/xml",autoScrollEditorIntoView:!0,tabSize:2,useSoftTabs:!0,indentedSoftWrap:!0,theme:Object(p.g)()}),this.content$.subscribe((function(t){return e.uiModelEditor.setValue(t||"",-1)})),Object(Oe.a)(this.uiModelEditor,"change").pipe(Object(je.a)(500)).subscribe((function(){return e.onChange(e.uiModelEditor.getValue())}))},t.\u0275fac=function(e){return ut(e||t)},t.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:t,selectors:[["app-tab-xml"]],viewQuery:function(e,t){var n;1&e&&fe["\u0275\u0275viewQuery"](ct,!0),2&e&&fe["\u0275\u0275queryRefresh"](n=fe["\u0275\u0275loadQuery"]())&&(t.uiModelEl=n.first)},features:[fe["\u0275\u0275InheritDefinitionFeature"]],decls:5,vars:2,consts:[[4,"ngIf","ngIfElse"],["errorTmpl",""],[1,"d-flex","flex-fill","h-100"],["uiModelEl",""],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner",4,"ngIf"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner"],["role","status",1,"spinner-border"],[1,"sr-only"],["type","danger"]],template:function(e,t){if(1&e&&(fe["\u0275\u0275template"](0,lt,7,1,"ng-container",0),fe["\u0275\u0275text"](1,"\n\n"),fe["\u0275\u0275template"](2,pt,7,1,"ng-template",null,1,fe["\u0275\u0275templateRefExtractor"]),fe["\u0275\u0275text"](4,"\n")),2&e){var n=fe["\u0275\u0275reference"](3);fe["\u0275\u0275property"]("ngIf",!t.error)("ngIfElse",n)}},directives:[r.NgIf,Ae.a],styles:[".spinner[_ngcontent-%COMP%]{left:0}"]}),t}(Ke),ut=fe["\u0275\u0275getInheritedFactory"](dt),ft=n("K9Ia"),mt=n("ny24"),bt=n("AXyZ");function vt(e,t){if(1&e){var n=fe["\u0275\u0275getCurrentView"]();fe["\u0275\u0275elementStart"](0,"app-db-table",2),fe["\u0275\u0275listener"]("tableChange",(function(e){return fe["\u0275\u0275restoreView"](n),fe["\u0275\u0275nextContext"]().onChange(e)}))("deleted",(function(){return fe["\u0275\u0275restoreView"](n),fe["\u0275\u0275nextContext"]().onDeleted()})),fe["\u0275\u0275elementEnd"]()}if(2&e){var i=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275property"]("dataObject",i.dataObject)("connection",i.tabData.info.connection)("saveBtn",!1)}}function ht(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",3),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275elementStart"](2,"div",4),fe["\u0275\u0275text"](3,"\n    "),fe["\u0275\u0275elementStart"](4,"span",5),fe["\u0275\u0275text"](5,"Loading..."),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](6,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](7,"\n"),fe["\u0275\u0275elementEnd"]())}var gt=function(){function e(e,t,n,i){this.dbService=e,this.notificationService=t,this.store=n,this.actions$=i,this.loading=!1,this.destroy$=new ft.a}return e.prototype.ngOnInit=function(){return Object(u.b)(this,void 0,void 0,(function(){var e=this;return Object(u.e)(this,(function(t){return this.actions$.pipe(Object(a.e)(N),Object(mt.a)(this.destroy$)).subscribe((function(t){t.keys.includes(e.getKey())&&e.loadData()})),this.loadData(),[2]}))}))},e.prototype.getKey=function(){return V(this.tabData.info.connection,this.tabData.info.sqlObject)},e.prototype.onChange=function(e){this.store.dispatch(S({key:this.getKey(),data:e}))},e.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},e.prototype.onDeleted=function(){this.store.dispatch(T({link:this.tabData.info})),this.store.dispatch(S({key:this.getKey(),data:null})),this.store.dispatch(O({links:[this.tabData.info]}))},e.prototype.loadData=function(){return Object(u.b)(this,void 0,void 0,(function(){var e,t,n,i;return Object(u.e)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,3,4]),this.loading=!0,n=this,[4,this.dbService.getMetaDataObject((e=this.tabData.info).connection.connectionName,(t=e.sqlObject).schemaName,t.objectName,t.objectType).toPromise()];case 1:return n.dataObject=r.sent(),[3,4];case 2:return i=r.sent(),this.notificationService.open({type:Z.f.DANGER,message:Object(p.i)(i)}),this.dataObject=null,[3,4];case 3:return this.loading=!1,[7];case 4:return[2]}}))}))},e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275directiveInject"](K.f),fe["\u0275\u0275directiveInject"](K.e),fe["\u0275\u0275directiveInject"](o.h),fe["\u0275\u0275directiveInject"](a.a))},e.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:e,selectors:[["app-tab-table"]],inputs:{tabData:"tabData"},decls:4,vars:2,consts:[[3,"dataObject","connection","saveBtn","tableChange","deleted",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[3,"dataObject","connection","saveBtn","tableChange","deleted"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(e,t){1&e&&(fe["\u0275\u0275template"](0,vt,1,3,"app-db-table",0),fe["\u0275\u0275text"](1,"\n"),fe["\u0275\u0275template"](2,ht,8,0,"div",1),fe["\u0275\u0275text"](3,"\n")),2&e&&(fe["\u0275\u0275property"]("ngIf",!t.loading&&t.dataObject),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",t.loading))},directives:[r.NgIf,bt.a],styles:["[_nghost-%COMP%]{position:relative}"]}),e}(),jt=n("xpqn");function yt(e,t){if(1&e){var n=fe["\u0275\u0275getCurrentView"]();fe["\u0275\u0275elementStart"](0,"app-db-view",2),fe["\u0275\u0275listener"]("viewChanged",(function(e){return fe["\u0275\u0275restoreView"](n),fe["\u0275\u0275nextContext"]().onChange(e)}))("deleted",(function(){return fe["\u0275\u0275restoreView"](n),fe["\u0275\u0275nextContext"]().onDeleted()})),fe["\u0275\u0275elementEnd"]()}if(2&e){var i=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275property"]("dataObject",i.dataObject)("connection",i.tabData.info.connection)}}function xt(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",3),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275elementStart"](2,"div",4),fe["\u0275\u0275text"](3,"\n    "),fe["\u0275\u0275elementStart"](4,"span",5),fe["\u0275\u0275text"](5,"Loading..."),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](6,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](7,"\n"),fe["\u0275\u0275elementEnd"]())}var wt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(u.d)(t,e),t.\u0275fac=function(e){return Ot(e||t)},t.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:t,selectors:[["app-tab-view"]],features:[fe["\u0275\u0275InheritDefinitionFeature"]],decls:4,vars:2,consts:[[3,"dataObject","connection","viewChanged","deleted",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[3,"dataObject","connection","viewChanged","deleted"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(e,t){1&e&&(fe["\u0275\u0275template"](0,yt,1,2,"app-db-view",0),fe["\u0275\u0275text"](1,"\n"),fe["\u0275\u0275template"](2,xt,8,0,"div",1),fe["\u0275\u0275text"](3,"\n")),2&e&&(fe["\u0275\u0275property"]("ngIf",!t.loading&&t.dataObject),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",t.loading))},directives:[r.NgIf,jt.a],styles:[""]}),t}(gt),Ot=fe["\u0275\u0275getInheritedFactory"](wt),Ct=n("8gf/");function St(e,t){if(1&e){var n=fe["\u0275\u0275getCurrentView"]();fe["\u0275\u0275elementStart"](0,"app-db-procedure",2),fe["\u0275\u0275listener"]("procedureChanged",(function(e){return fe["\u0275\u0275restoreView"](n),fe["\u0275\u0275nextContext"]().onChange(e)}))("procedureDeleted",(function(){return fe["\u0275\u0275restoreView"](n),fe["\u0275\u0275nextContext"]().onDeleted()})),fe["\u0275\u0275elementEnd"]()}if(2&e){var i=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275property"]("dataObject",i.dataObject)("connection",i.tabData.info.connection)}}function It(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",3),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275elementStart"](2,"div",4),fe["\u0275\u0275text"](3,"\n    "),fe["\u0275\u0275elementStart"](4,"span",5),fe["\u0275\u0275text"](5,"Loading..."),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](6,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](7,"\n"),fe["\u0275\u0275elementEnd"]())}var Et=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(u.d)(t,e),t.\u0275fac=function(e){return kt(e||t)},t.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:t,selectors:[["app-tab-procedure"]],features:[fe["\u0275\u0275InheritDefinitionFeature"]],decls:4,vars:2,consts:[[3,"dataObject","connection","procedureChanged","procedureDeleted",4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],[3,"dataObject","connection","procedureChanged","procedureDeleted"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(e,t){1&e&&(fe["\u0275\u0275template"](0,St,1,2,"app-db-procedure",0),fe["\u0275\u0275text"](1,"\n"),fe["\u0275\u0275template"](2,It,8,0,"div",1),fe["\u0275\u0275text"](3,"\n")),2&e&&(fe["\u0275\u0275property"]("ngIf",!t.loading&&t.dataObject),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",t.loading))},directives:[r.NgIf,Ct.a],styles:[""]}),t}(gt),kt=fe["\u0275\u0275getInheritedFactory"](Et),Nt=n("FbUF");function Tt(e,t){if(1&e&&fe["\u0275\u0275element"](0,"app-tab-jspy",8),2&e){var n=fe["\u0275\u0275nextContext"](2).$implicit;fe["\u0275\u0275property"]("tabData",n)}}function Mt(e,t){if(1&e&&fe["\u0275\u0275element"](0,"app-tab-page",8),2&e){var n=fe["\u0275\u0275nextContext"](2).$implicit;fe["\u0275\u0275property"]("tabData",n)}}function Pt(e,t){if(1&e&&fe["\u0275\u0275element"](0,"app-tab-xml",8),2&e){var n=fe["\u0275\u0275nextContext"](2).$implicit;fe["\u0275\u0275property"]("tabData",n)}}function At(e,t){if(1&e&&fe["\u0275\u0275element"](0,"app-tab-xml",8),2&e){var n=fe["\u0275\u0275nextContext"](2).$implicit;fe["\u0275\u0275property"]("tabData",n)}}function Dt(e,t){if(1&e&&(fe["\u0275\u0275elementStart"](0,"div"),fe["\u0275\u0275text"](1),fe["\u0275\u0275elementEnd"]()),2&e){var n,i=fe["\u0275\u0275nextContext"](2).$implicit,r=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](1),fe["\u0275\u0275textInterpolate1"]("\n        Content handler for application content type ",null==(n=r.getAppInfo(i))?null:n.contentType," not implemented yet.\n      ")}}function Ft(e,t){if(1&e&&(fe["\u0275\u0275elementContainerStart"](0,5),fe["\u0275\u0275text"](1,"\n      "),fe["\u0275\u0275template"](2,Tt,1,1,"app-tab-jspy",6),fe["\u0275\u0275text"](3,"\n      "),fe["\u0275\u0275template"](4,Mt,1,1,"app-tab-page",6),fe["\u0275\u0275text"](5,"\n      "),fe["\u0275\u0275template"](6,Pt,1,1,"app-tab-xml",6),fe["\u0275\u0275text"](7,"\n      "),fe["\u0275\u0275template"](8,At,1,1,"app-tab-xml",6),fe["\u0275\u0275text"](9,"\n      "),fe["\u0275\u0275template"](10,Dt,2,1,"div",7),fe["\u0275\u0275text"](11,"\n    "),fe["\u0275\u0275elementContainerEnd"]()),2&e){var n,i=fe["\u0275\u0275nextContext"]().$implicit,r=null==(n=fe["\u0275\u0275nextContext"]().getAppInfo(i))?null:n.contentType;fe["\u0275\u0275property"]("ngSwitch",r),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngSwitchCase","jspy"),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngSwitchCase","page.xml"),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngSwitchCase","shell.xml"),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngSwitchCase","xml")}}function Vt(e,t){if(1&e&&fe["\u0275\u0275element"](0,"app-tab-table",8),2&e){var n=fe["\u0275\u0275nextContext"](2).$implicit;fe["\u0275\u0275property"]("tabData",n)}}function _t(e,t){if(1&e&&fe["\u0275\u0275element"](0,"app-tab-view",8),2&e){var n=fe["\u0275\u0275nextContext"](2).$implicit;fe["\u0275\u0275property"]("tabData",n)}}function Lt(e,t){if(1&e&&fe["\u0275\u0275element"](0,"app-tab-procedure",8),2&e){var n=fe["\u0275\u0275nextContext"](2).$implicit;fe["\u0275\u0275property"]("tabData",n)}}function $t(e,t){if(1&e&&(fe["\u0275\u0275elementStart"](0,"div"),fe["\u0275\u0275text"](1,"\n        Content handler for Database content types not implemented yet.\n        "),fe["\u0275\u0275element"](2,"br"),fe["\u0275\u0275text"](3),fe["\u0275\u0275elementEnd"]()),2&e){var n=fe["\u0275\u0275nextContext"](2).$implicit,i=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](3),fe["\u0275\u0275textInterpolate1"]("\n        ",i.renderDbTabInfo(n),"\n      ")}}function qt(e,t){if(1&e&&(fe["\u0275\u0275elementContainerStart"](0,5),fe["\u0275\u0275text"](1,"\n      "),fe["\u0275\u0275template"](2,Vt,1,1,"app-tab-table",6),fe["\u0275\u0275text"](3,"\n      "),fe["\u0275\u0275template"](4,_t,1,1,"app-tab-view",6),fe["\u0275\u0275text"](5,"\n      "),fe["\u0275\u0275template"](6,Lt,1,1,"app-tab-procedure",6),fe["\u0275\u0275text"](7,"\n      "),fe["\u0275\u0275template"](8,$t,4,1,"div",7),fe["\u0275\u0275text"](9,"\n    "),fe["\u0275\u0275elementContainerEnd"]()),2&e){var n,i=fe["\u0275\u0275nextContext"]().$implicit,r=null==(n=fe["\u0275\u0275nextContext"]().getDbInfo(i))?null:n.sqlObject.objectType;fe["\u0275\u0275property"]("ngSwitch",r),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngSwitchCase","Table"),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngSwitchCase","View"),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngSwitchCase","Procedure")}}function Rt(e,t){if(1&e&&fe["\u0275\u0275element"](0,"app-db-query",9),2&e){var n=fe["\u0275\u0275nextContext"]().$implicit;fe["\u0275\u0275property"]("connections",n.info)}}function Qt(e,t){if(1&e){var n=fe["\u0275\u0275getCurrentView"]();fe["\u0275\u0275elementStart"](0,"tab",2),fe["\u0275\u0275listener"]("removed",(function(){fe["\u0275\u0275restoreView"](n);var e=t.$implicit;return fe["\u0275\u0275nextContext"]().onTabRemove(e)}))("selectTab",(function(){fe["\u0275\u0275restoreView"](n);var e=t.$implicit;return fe["\u0275\u0275nextContext"]().onSelectTab(e)})),fe["\u0275\u0275text"](1,"\n    "),fe["\u0275\u0275template"](2,Ft,12,5,"ng-container",3),fe["\u0275\u0275text"](3,"\n    "),fe["\u0275\u0275template"](4,qt,10,4,"ng-container",3),fe["\u0275\u0275text"](5,"\n    "),fe["\u0275\u0275template"](6,Rt,1,1,"app-db-query",4),fe["\u0275\u0275text"](7,"\n  "),fe["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit,r=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275property"]("heading",r.getHeader(i))("removable",!0),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",i.tabType===r.tabTypes.APP),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",i.tabType===r.tabTypes.DB),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",i.tabType===r.tabTypes.SQLQuery)}}var Bt=function(){function e(e){this.store=e,this.tabTypes=ue}return e.prototype.ngOnInit=function(){var e=this;this.tabs$=this.store.select(ae),this.store.select(ce).pipe(Object(H.a)((function(e){return Boolean(e)})),Object(je.a)(1)).subscribe((function(t){var n=e.tabset.tabs.map((function(e){return e.heading})).indexOf(e.getHeader(t));-1!==n&&(e.tabset.tabs[n].active=!0)})),this.store.select(se).subscribe((function(t){e.changedContent=t})),this.store.select(le).subscribe((function(t){e.changedObjects=t}))},e.prototype.getHeader=function(e){if(e.tabType===ue.APP){var t=e.info;return((this.changedContent||[]).find((function(e){return F(e,t)}))?"*  ":"")+Object(ye.b)(t)}if(e.tabType===ue.DB){var n=e.info,i=V(n.connection,n.sqlObject);return(this.changedObjects.hasOwnProperty(i)?"* ":"")+i}return e.tabType},e.prototype.getAppInfo=function(e){if(e.tabType===ue.APP)return e.info},e.prototype.getDbInfo=function(e){if(e.tabType===ue.DB)return e.info},e.prototype.onTabRemove=function(e){this.store.dispatch(O({links:[e.info]}))},e.prototype.onSelectTab=function(e){this.store.dispatch(w(e))},e.prototype.renderDbTabInfo=function(e){return JSON.stringify(e.info)},e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275directiveInject"](o.h))},e.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:e,selectors:[["app-tabs"]],viewQuery:function(e,t){var n;1&e&&fe["\u0275\u0275staticViewQuery"](ge.c,!0),2&e&&fe["\u0275\u0275queryRefresh"](n=fe["\u0275\u0275loadQuery"]())&&(t.tabset=n.first)},decls:6,vars:3,consts:[[1,"tabset-fx"],[3,"heading","removable","removed","selectTab",4,"ngFor","ngForOf"],[3,"heading","removable","removed","selectTab"],[3,"ngSwitch",4,"ngIf"],["class","h-100 w-100",3,"connections",4,"ngIf"],[3,"ngSwitch"],["class","h-100 w-100",3,"tabData",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"h-100","w-100",3,"tabData"],[1,"h-100","w-100",3,"connections"]],template:function(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"tabset",0),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275template"](2,Qt,8,5,"tab",1),fe["\u0275\u0275pipe"](3,"async"),fe["\u0275\u0275text"](4,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](5,"\n")),2&e&&(fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngForOf",fe["\u0275\u0275pipeBind1"](3,1,t.tabs$)))},directives:[xe.d,r.NgForOf,xe.a,r.NgIf,r.NgSwitch,r.NgSwitchCase,r.NgSwitchDefault,Ke,ot,dt,gt,wt,Et,Nt.a],pipes:[r.AsyncPipe],styles:['tabset[_ngcontent-%COMP%]     .bs-remove-tab{visibility:hidden;position:relative}tabset[_ngcontent-%COMP%]     .bs-remove-tab:after{content:"\\f00d";font-family:FontAwesome;color:inherit;position:absolute;visibility:visible;right:0}tabset[_ngcontent-%COMP%]     .tab-content{position:relative}']}),e}(),Gt=function(){return["/code"]},zt=function(){function e(e){this.store=e,this.layoutConfig={icon:"worksheets_logo",smIcon:"worksheets_logo",sidebar:Z.m.Opened,appName:"code",menuItems:[]}}return e.prototype.ngOnInit=function(){var e=this;this.hasLinksToSave$=this.store.select(pe),this.store.select(ie).pipe(Object(H.a)((function(e){return Boolean(e)})),Object(W.a)((function(e){return"/app/"+e.ownerName+"/"+e.appName}))).subscribe((function(t){return e.appUrl=t})),this.store.select(ce).pipe(Object(W.a)((function(e){var t,n,i=null===(t=e)||void 0===t?void 0:t.info;return(null===(n=e)||void 0===n?void 0:n.tabType)===ue.APP&&i.contentType===ve.a.PAGE?i:null}))).subscribe((function(t){return e.pageInfo=t}))},e.prototype.openApp=function(e){if(this.pageInfo){e.preventDefault();var t=this.pageInfo,n=t.queryString;window.open(this.appUrl+"/"+t.name+(n?"?"+n:""),"_blank")}},e.prototype.onSave=function(e){e.preventDefault(),e.stopImmediatePropagation(),this.store.dispatch(I()),this.store.dispatch(E())},e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275directiveInject"](o.h))},e.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:e,selectors:[["app-code-layout"]],decls:26,vars:7,consts:[[3,"config"],["title","",1,"cursor-pointer","h2","mb-0","ml-0","top-sub-header","w-md-down-50","mr-auto",3,"routerLink"],["header",""],[1,"btn","btn-primary","btn-sm","ml-auto","align-self-center",3,"click"],["target","_blank",1,"btn","btn-light","btn-sm","mx-2","align-self-center",3,"routerLink","click"],["sidebar",""],["content","",1,"main","h-100"],[1,"container-fluid","p-md-0","p-sm-2","h-100"]],template:function(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"app-layout",0),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275elementStart"](2,"a",1),fe["\u0275\u0275text"](3,"Code"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](4,"\n  "),fe["\u0275\u0275elementContainerStart"](5,2),fe["\u0275\u0275text"](6,"\n    "),fe["\u0275\u0275elementStart"](7,"button",3),fe["\u0275\u0275listener"]("click",(function(e){return t.onSave(e)})),fe["\u0275\u0275pipe"](8,"async"),fe["\u0275\u0275text"](9,"Save"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](10,"\n    "),fe["\u0275\u0275elementStart"](11,"a",4),fe["\u0275\u0275listener"]("click",(function(e){return t.openApp(e)})),fe["\u0275\u0275text"](12,"Open App"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](13,"\n  "),fe["\u0275\u0275elementContainerEnd"](),fe["\u0275\u0275text"](14,"\n\n  "),fe["\u0275\u0275element"](15,"router-outlet",5),fe["\u0275\u0275text"](16,"\n  "),fe["\u0275\u0275elementStart"](17,"main",6),fe["\u0275\u0275text"](18,"\n    "),fe["\u0275\u0275elementStart"](19,"div",7),fe["\u0275\u0275text"](20,"\n      "),fe["\u0275\u0275element"](21,"app-tabs"),fe["\u0275\u0275text"](22,"\n    "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](23,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](24,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](25,"\n")),2&e&&(fe["\u0275\u0275property"]("config",t.layoutConfig),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("routerLink",fe["\u0275\u0275pureFunction0"](6,Gt)),fe["\u0275\u0275advance"](5),fe["\u0275\u0275attribute"]("disabled",!fe["\u0275\u0275pipeBind1"](8,4,t.hasLinksToSave$)||null),fe["\u0275\u0275advance"](4),fe["\u0275\u0275property"]("routerLink",t.appUrl))},directives:[he.a,be.h,be.j,Bt],pipes:[r.AsyncPipe],styles:["[_nghost-%COMP%]{min-height:100vh;max-height:100%}[_nghost-%COMP%], [_nghost-%COMP%]   router-outlet[_ngcontent-%COMP%] +   app-code-sidebar{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}[_nghost-%COMP%]   router-outlet[_ngcontent-%COMP%] +   app-code-sidebar{height:100%;width:100%;padding:.5rem 0 .5rem .5rem}"]}),e}(),Wt=n("Ep24"),Ut=n("wxzg"),Ht=n("Uwcb"),Jt=n("GXwU"),Yt=n("OLrf"),Kt=n("6Fs3"),Xt=n("qaSM"),Zt=n("CXYP"),en=function(){function e(e,t,n,i){this.dbService=e,this.notificationService=t,this.store=n,this.actions$=i,this.destroy$=new ft.a,this.loadConnection=this._loadConnection.bind(this)}return e.prototype.ngOnInit=function(){var e=this;this.connections$=this.store.select(de).pipe(Object(W.a)((function(e){return e.map((function(e){return{label:e.connectionName,children:[],data:e}}))}))),this.store.select(ce).pipe(Object(mt.a)(this.destroy$)).subscribe((function(t){var n,i,r=null===(n=t)||void 0===n?void 0:n.info,o=Object(p.e)(e.tree.itemsSource,"children").find((function(e){return e.data===r}));o&&o!==e.tree.selectedItem?e.tree.selectedItem=o:(null===(i=t)||void 0===i?void 0:i.tabType)!==ue.DB&&(e.tree.selectedItem=void 0)})),this.actions$.pipe(Object(a.e)(T),Object(mt.a)(this.destroy$)).subscribe((function(t){e.tree.selectedNode.dataItem.data===t.link&&(e.tree.selectedNode.remove(),e.tree.selectedItem=void 0)}))},e.prototype._loadConnection=function(e,t){return Object(u.b)(this,void 0,void 0,(function(){var n,i,r;return Object(u.e)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.dbService.getObjects(e.dataItem.data.connectionName).toPromise()];case 1:return n=o.sent(),i=Object(Wt.groupBy)(n,"objectType"),t(i.map((function(t){return{label:t[0].objectType,children:t.map((function(t){return{label:t.schemaName+"."+t.objectName,data:{sqlObject:t,connection:e.dataItem.data}}}))}}))),[3,3];case 2:return r=o.sent(),this.notificationService.open({type:Z.f.DANGER,message:Object(p.i)(r)}),t(),[3,3];case 3:return[2]}}))}))},e.prototype.ngOnDestroy=function(){this.destroy$.next(),this.destroy$.complete()},e.prototype.onSelect=function(e){e.selectedItem.children||e.selectedItem.data&&this.store.dispatch(w({info:e.selectedItem.data,app:this.appInfo,tabType:ue.DB}))},e.prototype.formatItem=function(e){var t,n;n=0===e.level?"fa-database":e.dataItem.children?"fa-folder-o":((t={})[Z.g.Table]="fa-table",t[Z.g.View]="fa-file-text-o",t)[e.dataItem.data.objectType],e.element.innerHTML='<i class="fa '+n+'"></i> '+e.element.innerHTML},e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275directiveInject"](K.f),fe["\u0275\u0275directiveInject"](K.e),fe["\u0275\u0275directiveInject"](o.h),fe["\u0275\u0275directiveInject"](a.a))},e.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:e,selectors:[["app-db-tree"]],viewQuery:function(e,t){var n;1&e&&fe["\u0275\u0275staticViewQuery"](s.WjTreeView,!0),2&e&&fe["\u0275\u0275queryRefresh"](n=fe["\u0275\u0275loadQuery"]())&&(t.tree=n.first)},inputs:{appInfo:"appInfo"},decls:5,vars:5,consts:[["ngClass","vs-tree","displayMemberPath","label","childItemsPath","children",1,"p-2",3,"itemsSource","lazyLoadFunction","isReadOnly","itemClicked","formatItem"],["treeview",""]],template:function(e,t){if(1&e){var n=fe["\u0275\u0275getCurrentView"]();fe["\u0275\u0275elementStart"](0,"wj-tree-view",0,1),fe["\u0275\u0275listener"]("itemClicked",(function(){fe["\u0275\u0275restoreView"](n);var e=fe["\u0275\u0275reference"](1);return t.onSelect(e)}))("formatItem",(function(e){return t.formatItem(e)})),fe["\u0275\u0275pipe"](2,"async"),fe["\u0275\u0275text"](3,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](4,"\n")}2&e&&fe["\u0275\u0275property"]("itemsSource",fe["\u0275\u0275pipeBind1"](2,3,t.connections$))("lazyLoadFunction",t.loadConnection)("isReadOnly",!1)},directives:[s.WjTreeView,r.NgClass,Xt.a],pipes:[r.AsyncPipe],styles:['[_ngcontent-%COMP%]:root{--bg:#fff;--body-bg:#e4e5e6;--header-bg:#f0f3f5;--color:#23282c;--border-color:#c8ced3;--wj-alt:#f7f7f7;--form-input-bg:#fff;--form-input-color:#5c6873;--nav-link-color:#73818f;--secondary-color:#c8ced3;--opacity:0.05}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-node-text{min-width:20px}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node.error{border:1px solid #f86c6b}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node.error:before{visibility:hidden}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node.error .wj-node-text{position:relative}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node.error .wj-node-text:after{content:"\uf071";font-family:FontAwesome;color:#f86c6b;position:absolute;right:-1.25rem;top:0}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node.error .fa{visibility:hidden}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node{font-size:.85rem}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node .fa{font-size:.75rem}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-nodelist>.wj-node, .vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-nodelist>.wj-nodelist{border-left:1px solid var(--border-color)}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist .wj-node:not(.wj-state-empty):before{content:"\uf107";font-family:FontAwesome;top:2px;left:-2px;border:none;opacity:.8;font-size:1.5rem;-webkit-transition:all .3s cubic-bezier(.4,0,.2,1);transition:all .3s cubic-bezier(.4,0,.2,1);font-size:1.25rem;line-height:10px}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist .wj-node.wj-state-empty:before{display:none}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-node.wj-state-selected{background:var(--border-color)}']}),e}(),tn=["folderMenu"],nn=["fileMenu"],rn=function(){function e(e,t,n){this.store=e,this.notificationService=t,this.dialogService=n,this.links=[],this.addToRoot=!1,this.destroy=new ft.a}return e.prototype.ngOnInit=function(){var e=this;this.links$=this.store.select(re).pipe(Object(mt.a)(this.destroy),Object(W.a)((function(t){var n=t.map((function(t){return e.getFlatFolderLinks(t)})),i=Object(Wt.groupBy)(n,"label");return Object(Wt.sort)(i.map((function(t){return e.getTreeLink(t)})),"children DESC","label ASC")}))),this.store.select(ne).pipe(Object(mt.a)(this.destroy),Object(J.a)(this.links$)).subscribe((function(t){e.links=t[1]})),this.store.select(ce).pipe(Object(mt.a)(this.destroy)).subscribe((function(t){var n,i,r=null===(n=t)||void 0===n?void 0:n.info,o=Object(p.e)(e.tree.itemsSource,"children").find((function(e){return e.link===r}));o&&o!==e.tree.selectedItem?e.tree.selectedItem=o:(null===(i=t)||void 0===i?void 0:i.tabType)!==ue.APP&&(e.tree.selectedItem=void 0)}))},e.prototype.ngOnDestroy=function(){this.destroy.next(),this.destroy.complete()},e.prototype.showContextMenu=function(e,t){var n,i;e.preventDefault(),"app.xml"!==(null===(n=t.selectedItem)||void 0===n?void 0:n.label)&&(this.addToRoot="WJ-TREE-VIEW"===e.toElement.tagName,(null===(i=t.selectedItem)||void 0===i?void 0:i.children)||this.addToRoot?this.folderMenu.show(e):this.fileMenu.show(e))},e.prototype.folderMenuClick=function(e,t){switch(e.selectedValue){case"new-script":this.createNode(t,{label:"new-script.jspy"});break;case"new-page":this.createNode(t,{label:"new-page.page.xml"});break;case"new-folder":this.createNode(t,{label:"new-folder",children:[]});break;case"rename":t.startEditing(t.selectedNode);break;case"delete":this.deleteNode(t.selectedNode)}},e.prototype.fileMenuClick=function(e,t){switch(e.selectedValue){case"rename":t.startEditing(t.selectedNode);break;case"delete":this.deleteNode(t.selectedNode)}},e.prototype.onFileSelect=function(e){e.selectedItem.children||e.selectedItem.link&&this.store.dispatch(w({info:e.selectedItem.link,app:this.appInfo,tabType:ue.APP}))},e.prototype.onEditStarting=function(e){var t;"app.xml"===(null===(t=e.node.dataItem)||void 0===t?void 0:t.label)&&(e.cancel=!0)},e.prototype.onEditEnding=function(e){var t=e.node;return this.getNodeText(t)?this.validateName(t)&&this.validateNameUnique(t)?(e.cancel=!1,e):(e.cancel=!0,e):(e.node.dataItem.previousLabel=t.dataItem.label,e)},e.prototype.onEditEnded=function(e){var t,n=e.node;n.element.classList.remove("error"),n.element.removeAttribute("title");var i=n.dataItem,r=!1;i.label?r=i.children?this.updateFolders(n):this.saveLink(n):n.hasChildren||(null===(t=i.link)||void 0===t?void 0:t.contentId)?(i.label=i.previousLabel,delete i.previousLabel,n.element.querySelector("span.wj-node-text").innerText=i.label):n.remove(),r&&this.refreshTree(n)},e.prototype.createFolder=function(){this.tree.selectedNode=null,this.createNode(this.tree,{label:"new-folder",children:[]})},e.prototype.createFile=function(e){this.tree.selectedNode=null,this.createNode(this.tree,{label:e})},e.prototype.formatItem=function(e){var t,n;n=e.dataItem.children?"fa-folder-o":((t={})[ve.a.PAGE]="fa-file-code-o",t[ve.a.SCRIPT]="fa-file-text-o",t[ve.a.SHELL]="fa-file-image-o",t[ve.a.APP]="fa-file-o",t)[e.dataItem.link.contentType],e.element.innerHTML='<i class="fa '+n+'"></i> '+e.element.innerHTML},e.prototype.refreshTree=function(e){var t,n=null===(t=e.parentNode)||void 0===t?void 0:t.dataItem;n?(Object(Wt.sort)(n.children,"children DESC","label ASC"),n.children=Object(u.i)(n.children)):Object(Wt.sort)(this.links,"children DESC","label ASC"),this.tree.loadTree()},e.prototype.saveLink=function(e){var t,n=e.dataItem,i=this.getContentType(n.label),r=n.label.replace("."+i,""),o=this.getFolder(e);return r!==(null===(t=n.link)||void 0===t?void 0:t.name)&&(n.link=Object.assign(n.link||{},{name:r,contentType:i,folder:o}),void 0===n.link.contentId&&n.link.contentType===ve.a.PAGE&&(n.link.content="<page></page>"),n.link.contentId&&n.link.hasOwnProperty("content")&&delete n.link.content,this.store.dispatch(g({link:n.link})),!0)},e.prototype.updateFolders=function(e){var t=this;if(e.nodes)return e.nodes.map((function(e){return t.updateFolders(e)})).some((function(e){return e}));if(e.dataItem.link){var n=e.dataItem.link,i=this.getFolder(e);if(n.folder!==i)return n.folder=i,this.store.dispatch(g({link:n})),!0}},e.prototype.getContentType=function(e){return Object.values(ve.a).find((function(t){return e.endsWith("."+t)}))},e.prototype.getFolder=function(e){for(var t=[];e.parentNode;)t.push(e.parentNode.dataItem.label),e=e.parentNode;return t.reverse().join("/")},e.prototype.deleteNode=function(e){var t=this,n=e.dataItem;this.dialogService.confirmation("Delete "+(n.children?"folder":"file")+" "+n.label).subscribe((function(i){if(i){var r=t.getLinks(n);t.store.dispatch(y({links:r})),t.store.dispatch(O({links:r})),e.remove()}}))},e.prototype.getLinks=function(e){var t=this;return e.children?Object(Wt.flatten)(e.children.map((function(e){return t.getLinks(e)}))):[e.link]},e.prototype.validateName=function(e){var t=this.getNodeText(e),n=!!e.dataItem.children;if(n&&!t.length)return this.showError(o="Folder name can't be empty",e),!1;if(!n){var i=Object.values(ve.a),r=i.find((function(e){return t.endsWith("."+e)}));if(!r){var o="File should be one of the types: "+i.join(", ");return this.showError(o,e),!1}if(!t.replace(r,"").length)return this.showError(o="File name can't be empty",e),!1}return!0},e.prototype.validateNameUnique=function(e){var t=this.getNodeText(e);return!(e.parentNode?e.parentNode.nodes.map((function(e){return e.dataItem})):this.links).find((function(n){return e.dataItem!==n&&n.label===t}))||(this.showError('File or folder name - "'+t+'" already exist.',e),!1)},e.prototype.getNodeText=function(e){return e.element.innerText.replace(/\r?\n|\r/g,"").trim()},e.prototype.showError=function(e,t){this.notify&&this.notify.instance.modal.isShown||(this.notify=this.notificationService.open({type:Z.f.DANGER,message:e}),this.notify.instance.modal.onHide.subscribe((function(){t.element.querySelector(".wj-node-text").focus()}))),t.element.classList.add("error"),t.element.setAttribute("title",e)},e.prototype.getFlatFolderLinks=function(e){var t=(e.folder||"").split("/"),n=t.shift();if(!t.length)return{label:e.folder||e.name+"."+e.contentType,link:e};var i={label:n,child:{label:null}};return t.reduce((function(n,i,r){if(n.label=i,r!==t.length-1)return n.child={label:null},n.child;Object.assign(n,{folder:i,link:e})}),i.child),i},e.prototype.getTreeLink=function(e){var t,n,i=this,r={label:e[0].label};if(1===e.length){var o=e[0];if(o.label===(null===(t=o.link)||void 0===t?void 0:t.name)+"."+(null===(n=o.link)||void 0===n?void 0:n.contentType))return r.link=o.link,r}var a=e.filter((function(e){return e.link})).map((function(e){var t=e.link;return{label:t.name+"."+t.contentType,link:t}})),c=Object(Wt.groupBy)(e.filter((function(e){return e.child})).map((function(e){return e.child})),"label").map((function(e){return i.getTreeLink(e)}));return a.length&&(r.children=Object(Wt.sort)(a,"label ASC")),c.length&&(r.children=Object(u.i)(c,r.children||[])),r},e.prototype.createNode=function(e,t){var n=0===this.links.length;!e.selectedNode||this.addToRoot?n?this.links=[t]:e.selectedNode=e.addChildNode(0,t):e.selectedNode=e.selectedNode.addChildNode(0,t),setTimeout((function(){n&&(e.selectedNode=e.nodes[0]),e.startEditing(e.selectedNode)}),100)},e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275directiveInject"](o.h),fe["\u0275\u0275directiveInject"](K.e),fe["\u0275\u0275directiveInject"](K.b))},e.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:e,selectors:[["app-tree"]],viewQuery:function(e,t){var n;1&e&&(fe["\u0275\u0275staticViewQuery"](tn,!0),fe["\u0275\u0275staticViewQuery"](nn,!0),fe["\u0275\u0275staticViewQuery"](s.WjTreeView,!0)),2&e&&(fe["\u0275\u0275queryRefresh"](n=fe["\u0275\u0275loadQuery"]())&&(t.folderMenu=n.first),fe["\u0275\u0275queryRefresh"](n=fe["\u0275\u0275loadQuery"]())&&(t.fileMenu=n.first),fe["\u0275\u0275queryRefresh"](n=fe["\u0275\u0275loadQuery"]())&&(t.tree=n.first))},inputs:{appInfo:"appInfo"},decls:37,vars:2,consts:[["ngClass","vs-tree","displayMemberPath","label","childItemsPath","children",1,"p-2",3,"itemsSource","isReadOnly","itemClicked","contextmenu","nodeEditStarting","nodeEditEnding","nodeEditEnded","formatItem"],["treeview",""],[2,"display","none",3,"itemClicked"],["folderMenu",""],["value","new-folder"],["value","new-script"],["value","new-page"],["value","rename"],["value","delete"],["fileMenu",""]],template:function(e,t){if(1&e){var n=fe["\u0275\u0275getCurrentView"]();fe["\u0275\u0275elementStart"](0,"wj-tree-view",0,1),fe["\u0275\u0275listener"]("itemClicked",(function(){fe["\u0275\u0275restoreView"](n);var e=fe["\u0275\u0275reference"](1);return t.onFileSelect(e)}))("contextmenu",(function(e){fe["\u0275\u0275restoreView"](n);var i=fe["\u0275\u0275reference"](1);return t.showContextMenu(e,i)}))("nodeEditStarting",(function(e){return t.onEditStarting(e)}))("nodeEditEnding",(function(e){return t.onEditEnding(e)}))("nodeEditEnded",(function(e){return t.onEditEnded(e)}))("formatItem",(function(e){return t.formatItem(e)})),fe["\u0275\u0275text"](2,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](3,"\n"),fe["\u0275\u0275elementStart"](4,"wj-menu",2,3),fe["\u0275\u0275listener"]("itemClicked",(function(){fe["\u0275\u0275restoreView"](n);var e=fe["\u0275\u0275reference"](5),i=fe["\u0275\u0275reference"](1);return t.folderMenuClick(e,i)})),fe["\u0275\u0275text"](6,"\n  "),fe["\u0275\u0275elementStart"](7,"wj-menu-item",4),fe["\u0275\u0275text"](8,"New Folder"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](9,"\n  "),fe["\u0275\u0275elementStart"](10,"wj-menu-item",5),fe["\u0275\u0275text"](11,"New Script"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](12,"\n  "),fe["\u0275\u0275elementStart"](13,"wj-menu-item",6),fe["\u0275\u0275text"](14,"New Page"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](15,"\n  "),fe["\u0275\u0275element"](16,"wj-menu-separator"),fe["\u0275\u0275text"](17,"\n  "),fe["\u0275\u0275elementStart"](18,"wj-menu-item",7),fe["\u0275\u0275text"](19,"Rename Folder"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](20,"\n  "),fe["\u0275\u0275elementStart"](21,"wj-menu-item",8),fe["\u0275\u0275text"](22,"Delete Folder"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](23,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](24,"\n"),fe["\u0275\u0275elementStart"](25,"wj-menu",2,9),fe["\u0275\u0275listener"]("itemClicked",(function(){fe["\u0275\u0275restoreView"](n);var e=fe["\u0275\u0275reference"](26),i=fe["\u0275\u0275reference"](1);return t.fileMenuClick(e,i)})),fe["\u0275\u0275text"](27,"\n  "),fe["\u0275\u0275elementStart"](28,"wj-menu-item",7),fe["\u0275\u0275text"](29,"Rename"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](30,"\n  "),fe["\u0275\u0275element"](31,"wj-menu-separator"),fe["\u0275\u0275text"](32,"\n  "),fe["\u0275\u0275elementStart"](33,"wj-menu-item",8),fe["\u0275\u0275text"](34,"Delete File"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](35,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](36,"\n")}2&e&&fe["\u0275\u0275property"]("itemsSource",t.links)("isReadOnly",!1)},directives:[s.WjTreeView,r.NgClass,Xt.a,l.WjMenu,l.WjMenuItem,l.WjMenuSeparator],styles:['[_ngcontent-%COMP%]:root{--bg:#fff;--body-bg:#e4e5e6;--header-bg:#f0f3f5;--color:#23282c;--border-color:#c8ced3;--wj-alt:#f7f7f7;--form-input-bg:#fff;--form-input-color:#5c6873;--nav-link-color:#73818f;--secondary-color:#c8ced3;--opacity:0.05}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-node-text{min-width:20px}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node.error{border:1px solid #f86c6b}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node.error:before{visibility:hidden}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node.error .wj-node-text{position:relative}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node.error .wj-node-text:after{content:"\uf071";font-family:FontAwesome;color:#f86c6b;position:absolute;right:-1.25rem;top:0}wj-tree-view.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node.error .fa{visibility:hidden}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node{font-size:.85rem}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-node .fa{font-size:.75rem}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-nodelist>.wj-node, .vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist>.wj-nodelist>.wj-nodelist{border-left:1px solid var(--border-color)}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist .wj-node:not(.wj-state-empty):before{content:"\uf107";font-family:FontAwesome;top:2px;left:-2px;border:none;opacity:.8;font-size:1.5rem;-webkit-transition:all .3s cubic-bezier(.4,0,.2,1);transition:all .3s cubic-bezier(.4,0,.2,1);font-size:1.25rem;line-height:10px}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-nodelist .wj-node.wj-state-empty:before{display:none}.vs-tree.wj-treeview[_ngcontent-%COMP%]     .wj-node.wj-state-selected{background:var(--border-color)}']}),e}();function on(e,t){if(1&e){var n=fe["\u0275\u0275getCurrentView"]();fe["\u0275\u0275elementStart"](0,"a",22),fe["\u0275\u0275listener"]("click",(function(){fe["\u0275\u0275restoreView"](n);var e=t.$implicit;return fe["\u0275\u0275nextContext"](2).onSelect(e)})),fe["\u0275\u0275text"](1,"\n        "),fe["\u0275\u0275element"](2,"i",23),fe["\u0275\u0275text"](3),fe["\u0275\u0275elementEnd"]()}if(2&e){var i=t.$implicit;fe["\u0275\u0275propertyInterpolate"]("title",i.title),fe["\u0275\u0275advance"](3),fe["\u0275\u0275textInterpolate2"](" ",i.appName," (",i.ownerName,")\n      ")}}function an(e,t){if(1&e&&(fe["\u0275\u0275elementStart"](0,"div",20),fe["\u0275\u0275text"](1,"\n      "),fe["\u0275\u0275template"](2,on,4,3,"a",21),fe["\u0275\u0275pipe"](3,"async"),fe["\u0275\u0275text"](4,"\n    "),fe["\u0275\u0275elementEnd"]()),2&e){var n=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngForOf",fe["\u0275\u0275pipeBind1"](3,1,n.customApps$))}}function cn(e,t){if(1&e){var n=fe["\u0275\u0275getCurrentView"]();fe["\u0275\u0275elementStart"](0,"ul",34),fe["\u0275\u0275text"](1,"\n          "),fe["\u0275\u0275elementStart"](2,"li",35),fe["\u0275\u0275text"](3,"\n            "),fe["\u0275\u0275elementStart"](4,"a",36),fe["\u0275\u0275listener"]("click",(function(e){return fe["\u0275\u0275restoreView"](n),fe["\u0275\u0275nextContext"](),fe["\u0275\u0275reference"](23).createFile("new-script.jspy"),e.preventDefault(),e.stopImmediatePropagation()})),fe["\u0275\u0275text"](5,"New Script"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](6,"\n            "),fe["\u0275\u0275elementStart"](7,"a",36),fe["\u0275\u0275listener"]("click",(function(e){return fe["\u0275\u0275restoreView"](n),fe["\u0275\u0275nextContext"](),fe["\u0275\u0275reference"](23).createFile("new-page.page.xml"),e.preventDefault(),e.stopImmediatePropagation()})),fe["\u0275\u0275text"](8,"New Page"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](9,"\n          "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](10,"\n        "),fe["\u0275\u0275elementEnd"]()}}function sn(e,t){if(1&e){var n=fe["\u0275\u0275getCurrentView"]();fe["\u0275\u0275elementStart"](0,"accordion-group",24),fe["\u0275\u0275text"](1,"\n    "),fe["\u0275\u0275elementContainerStart"](2,13),fe["\u0275\u0275text"](3,"\n      "),fe["\u0275\u0275elementStart"](4,"span",25),fe["\u0275\u0275listener"]("click",(function(e){return fe["\u0275\u0275restoreView"](n),fe["\u0275\u0275reference"](23).createFolder(),e.preventDefault(),e.stopImmediatePropagation()})),fe["\u0275\u0275text"](5,"\n        +"),fe["\u0275\u0275element"](6,"i",26),fe["\u0275\u0275text"](7,"\n      "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](8,"\n      "),fe["\u0275\u0275elementStart"](9,"div",27),fe["\u0275\u0275listener"]("click",(function(e){return fe["\u0275\u0275restoreView"](n),e.preventDefault(),e.stopImmediatePropagation()})),fe["\u0275\u0275text"](10,"\n        "),fe["\u0275\u0275elementStart"](11,"span",28),fe["\u0275\u0275listener"]("click",(function(){return!1})),fe["\u0275\u0275text"](12,"\n          +"),fe["\u0275\u0275element"](13,"i",29),fe["\u0275\u0275text"](14,"\n          "),fe["\u0275\u0275element"](15,"span",30),fe["\u0275\u0275text"](16,"\n      "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](17,"\n\n        "),fe["\u0275\u0275template"](18,cn,11,0,"ul",31),fe["\u0275\u0275text"](19,"\n      "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](20,"\n    "),fe["\u0275\u0275elementContainerEnd"](),fe["\u0275\u0275text"](21,"\n    "),fe["\u0275\u0275element"](22,"app-tree",32,33),fe["\u0275\u0275text"](24,"\n  "),fe["\u0275\u0275elementEnd"]()}if(2&e){var i=fe["\u0275\u0275nextContext"]();fe["\u0275\u0275advance"](22),fe["\u0275\u0275property"]("appInfo",i.app)}}var ln=function(e){return{disabled:e}},pn=function(){function e(e,t,n,i,r,o){this.store=e,this.router=t,this.route=n,this.dialogService=i,this.appService=r,this.authService=o,this.defaultAppInfo=Ht.a,this.hasContentToSave=!1,this.destroy=new ft.a}return e.prototype.ngOnInit=function(){var e=this;this.store.dispatch(M()),this.customApps$=this.store.select(te),this.store.select(ie).subscribe((function(t){e.app=t})),this.store.select(se).subscribe((function(t){e.hasContentToSave=Boolean(t&&t.length)})),this.store.select(de).subscribe((function(t){e.connections=t})),this.store.select(re).pipe(Object(W.a)((function(e){return Object(Wt.groupBy)(e||[],"contentType").reduce((function(e,t){return e[t[0].contentType]=t.map((function(e){return Object(ye.b)(e)})),e}),{})}))).subscribe((function(t){e.scripts=t[ve.a.SCRIPT]||[],e.shells=t[ve.a.SHELL]||[]})),this.route.firstChild&&this.onAppSelect(this.route.firstChild.snapshot.params),this.router.events.pipe(Object(mt.a)(this.destroy),Object(H.a)((function(t){return Boolean(t instanceof be.c&&e.route.firstChild)})),Object(W.a)((function(){return e.route.firstChild.snapshot.params}))).subscribe((function(t){return e.onAppSelect(t)}))},e.prototype.editApp=function(){var e=this;if(this.app){this.store.dispatch(b({app:this.app}));var t=this.dialogService.open(Ut.a,{class:"modal-xl full-height"});t.config={appInfo$:this.store.select(ie),scripts:this.scripts,shells:this.shells},t.init.subscribe((function(){t.component.save.pipe(Object(z.a)((function(t){return e.appService.saveAppInfo(t.appInfo)}))).subscribe(),t.component.delete.pipe(Object(z.a)((function(t){return e.appService.deleteApp(t)}))).subscribe((function(){e.store.dispatch(f()),e.router.navigate(["/code/app"])}))}))}},e.prototype.createApp=function(){var e=this,t=this.dialogService.open(Ut.a,{class:"modal-xl full-height"});t.config={appInfo:Object(u.a)(Object(u.a)({},this.defaultAppInfo),{ownerName:this.authService.user.userName})},t.init.pipe(Object(z.a)((function(){return t.component.save})),Object(z.a)((function(t){var n=t.appInfo,i=t.permissionsToSave;return e.appService.saveAppInfo(n).pipe(Object(W.a)((function(e){return Object(u.a)(Object(u.a)({},n),{appId:e,permissions:i})})))}))).subscribe((function(t){t.permissions&&t.permissions.forEach((function(n){n.appId=t.appId,e.appService.saveAppPermission(n).toPromise()})),e.store.dispatch(f()),e.router.navigate(["code/app",t.ownerName,t.appName])}))},e.prototype.onSelect=function(e){var t=this;this.hasContentToSave?this.dialogService.confirmation("Not all changes are saved. Continue?").subscribe((function(n){n&&t.router.navigate(["code/app",e.ownerName,e.appName])})):this.router.navigate(["code/app",e.ownerName,e.appName])},e.prototype.createSqlQuery=function(e){e.preventDefault(),e.stopImmediatePropagation(),this.store.dispatch(w({tabType:ue.SQLQuery,app:null,info:this.connections}))},e.prototype.import=function(e){var t=this;e.preventDefault(),e.stopImmediatePropagation();var n=this.dialogService.open(Jt.a,{class:"modal-xl full-height",keyboard:!1});n.config={connections:this.connections,connection:null},n.init.pipe(Object(z.a)((function(){return n.component.import}))).subscribe((function(e){e.newTable&&t.store.dispatch(M())}))},e.prototype.refresh=function(e){e.preventDefault(),e.stopImmediatePropagation(),this.store.dispatch(M())},e.prototype.ngOnDestroy=function(){this.destroy.next(),this.destroy.complete()},e.prototype.compareApps=function(e,t){return e&&t&&e.appName===t.appName&&e.ownerName===t.ownerName},e.prototype.onAppSelect=function(e){this.store.dispatch(b({app:e})),this.store.dispatch(x())},e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275directiveInject"](o.h),fe["\u0275\u0275directiveInject"](be.f),fe["\u0275\u0275directiveInject"](be.a),fe["\u0275\u0275directiveInject"](K.b),fe["\u0275\u0275directiveInject"](X.a),fe["\u0275\u0275directiveInject"](Yt.b))},e.\u0275cmp=fe["\u0275\u0275defineComponent"]({type:e,selectors:[["app-code-sidebar"]],decls:54,vars:6,consts:[[1,"mb-1","d-flex"],["dropdown","",1,"ml-2","dropdown"],["data-toggle","dropdown","role","button","aria-haspopup","true","aria-expanded","false","dropdownToggle","",1,"my-0","cursor-pointer",3,"click"],[1,"fa","fa-caret-down","ml-1"],["class","dropdown-menu","aria-labelledby","simple-dropdown",4,"dropdownMenu"],["title","Edit Application",1,"ml-auto","align-self-center","px-1","cursor-pointer",3,"ngClass","click"],[1,"fa","fa-pencil"],["title","Create new Application",1,"align-self-center","mx-2","px-1","cursor-pointer",3,"click"],[1,"fa","fa-plus"],[1,"d-flex","flex-column","overflow-hidden"],[1,"d-flex","flex-column","h-100",3,"isAnimated"],["class","files-panel overflow-hidden","heading","EXPLORER","isOpen","true",4,"ngIf"],["heading","CONNECTION","isOpen","true",1,"files-panel","overflow-hidden"],["accordion-heading",""],[1,"ml-auto","align-self-center","action","my-0","p-1",3,"click"],["title","Import data",1,"fa","fa-upload"],[1,"mx-1","align-self-center","action","my-0","p-1",3,"click"],["title","Refresh connections",1,"fa","fa-refresh"],[1,"mr-1","align-self-center","action","my-0","p-1",3,"click"],["title","Create sql query",1,"fa","fa-code"],["aria-labelledby","simple-dropdown",1,"dropdown-menu"],["class","dropdown-item",3,"title","click",4,"ngFor","ngForOf"],[1,"dropdown-item",3,"title","click"],[1,"fa","fa-play"],["heading","EXPLORER","isOpen","true",1,"files-panel","overflow-hidden"],[1,"ml-auto","align-self-center","action",3,"click"],["title","Create root folder",1,"fa","fa-folder-o"],["dropdown","","placement","bottom left",1,"btn-group","align-self-center","mx-2","action",3,"click"],["title","Create files","data-toggle","dropdown","aria-controls","dropdown-basic","role","button","aria-haspopup","true","aria-expanded","false","dropdownToggle","",1,"dropdown-toggle","m-0","ml-2",3,"click"],["title","Create root file",1,"fa","fa-file-o"],[1,"caret"],["id","dropdown-basic","class","dropdown-menu left-menu","role","menu","aria-labelledby","button-basic",4,"dropdownMenu"],[3,"appInfo"],["tree",""],["id","dropdown-basic","role","menu","aria-labelledby","button-basic",1,"dropdown-menu","left-menu"],["role","menuitem"],[1,"dropdown-item",3,"click"]],template:function(e,t){1&e&&(fe["\u0275\u0275elementStart"](0,"div",0),fe["\u0275\u0275text"](1,"\n  "),fe["\u0275\u0275elementStart"](2,"span",1),fe["\u0275\u0275text"](3,"\n    "),fe["\u0275\u0275elementStart"](4,"h3",2),fe["\u0275\u0275listener"]("click",(function(){return!1})),fe["\u0275\u0275text"](5),fe["\u0275\u0275element"](6,"i",3),fe["\u0275\u0275text"](7,"\n    "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](8,"\n    "),fe["\u0275\u0275template"](9,an,5,3,"div",4),fe["\u0275\u0275text"](10,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](11,"\n  "),fe["\u0275\u0275elementStart"](12,"span",5),fe["\u0275\u0275listener"]("click",(function(e){return t.editApp(),e.preventDefault(),e.stopImmediatePropagation()})),fe["\u0275\u0275text"](13,"\n    "),fe["\u0275\u0275element"](14,"i",6),fe["\u0275\u0275text"](15,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](16,"\n  "),fe["\u0275\u0275elementStart"](17,"span",7),fe["\u0275\u0275listener"]("click",(function(e){return t.createApp(),e.preventDefault(),e.stopImmediatePropagation()})),fe["\u0275\u0275text"](18,"\n    "),fe["\u0275\u0275element"](19,"i",8),fe["\u0275\u0275text"](20,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](21,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](22,"\n"),fe["\u0275\u0275elementStart"](23,"div",9),fe["\u0275\u0275text"](24,"\n"),fe["\u0275\u0275elementStart"](25,"accordion",10),fe["\u0275\u0275text"](26,"\n  "),fe["\u0275\u0275template"](27,sn,25,1,"accordion-group",11),fe["\u0275\u0275text"](28,"\n  "),fe["\u0275\u0275elementStart"](29,"accordion-group",12),fe["\u0275\u0275text"](30,"\n    "),fe["\u0275\u0275elementContainerStart"](31,13),fe["\u0275\u0275text"](32,"\n      "),fe["\u0275\u0275elementStart"](33,"span",14),fe["\u0275\u0275listener"]("click",(function(e){return t.import(e)})),fe["\u0275\u0275text"](34,"\n        "),fe["\u0275\u0275element"](35,"i",15),fe["\u0275\u0275text"](36,"\n      "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](37,"\n      "),fe["\u0275\u0275elementStart"](38,"span",16),fe["\u0275\u0275listener"]("click",(function(e){return t.refresh(e)})),fe["\u0275\u0275text"](39,"\n        "),fe["\u0275\u0275element"](40,"i",17),fe["\u0275\u0275text"](41,"\n      "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](42,"\n      "),fe["\u0275\u0275elementStart"](43,"span",18),fe["\u0275\u0275listener"]("click",(function(e){return t.createSqlQuery(e)})),fe["\u0275\u0275text"](44,"\n        +"),fe["\u0275\u0275element"](45,"i",19),fe["\u0275\u0275text"](46,"\n      "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](47,"\n    "),fe["\u0275\u0275elementContainerEnd"](),fe["\u0275\u0275text"](48,"\n    "),fe["\u0275\u0275element"](49,"app-db-tree"),fe["\u0275\u0275text"](50,"\n  "),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](51,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](52,"\n"),fe["\u0275\u0275elementEnd"](),fe["\u0275\u0275text"](53,"\n")),2&e&&(fe["\u0275\u0275advance"](5),fe["\u0275\u0275textInterpolate1"]("",null==t.app?null:t.app.appName,"\n      "),fe["\u0275\u0275advance"](7),fe["\u0275\u0275property"]("ngClass",fe["\u0275\u0275pureFunction1"](4,ln,!t.app)),fe["\u0275\u0275advance"](13),fe["\u0275\u0275property"]("isAnimated",!0),fe["\u0275\u0275advance"](2),fe["\u0275\u0275property"]("ngIf",t.app))},directives:[Kt.a,Kt.d,Kt.b,r.NgClass,Xt.a,Zt.a,r.NgIf,Zt.c,en,r.NgForOf,rn],pipes:[r.AsyncPipe],styles:["span.disabled[_ngcontent-%COMP%]{opacity:.5}.files-panel[_ngcontent-%COMP%]     .panel.card{height:100%}.files-panel[_ngcontent-%COMP%]     .panel-title .accordion-toggle>button{color:var(--color);padding-left:.5rem;text-decoration:none}.files-panel[_ngcontent-%COMP%]     .panel-body.card-block.card-body{padding:0}.files-panel[_ngcontent-%COMP%]     .panel-collapse.collapse.in.show{overflow:auto!important}.files-panel.panel-open[_ngcontent-%COMP%]{-webkit-box-flex:1;flex:1 1 auto}.files-panel[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{margin-bottom:8px}.files-panel[_ngcontent-%COMP%]   .fa.fa-folder-o[_ngcontent-%COMP%]{margin-left:-7px;position:absolute;top:11px}.files-panel[_ngcontent-%COMP%]   .fa.fa-file-o[_ngcontent-%COMP%]{margin-left:-6px;position:absolute;top:9px}accordion[_ngcontent-%COMP%]     .accordion-toggle{display:-webkit-box;display:flex}accordion[_ngcontent-%COMP%]     .panel.card{margin-bottom:1px}"]}),e}(),dn=n("t9fZ"),un=function(){function e(e,t){this.store=e,this.router=t}return e.prototype.canActivate=function(e,t){var n,i=this;this.store.dispatch(f());var r=null===(n=e.firstChild)||void 0===n?void 0:n.params;return this.store.select(te).pipe(Object(H.a)((function(e){return void 0!==e})),Object(W.a)((function(e){var t,n;if(!r&&(null===(t=e)||void 0===t?void 0:t.length))i.router.navigate(["code","app",e[0].ownerName,e[0].appName]);else{if(!r)return!0;if(null===(n=e)||void 0===n?void 0:n.some((function(e){return e.ownerName===r.ownerName&&e.appName===r.appName})))return!0;i.router.navigate(["code","app"])}})),Object(dn.a)(1))},e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275inject"](o.h),fe["\u0275\u0275inject"](be.f))},e.\u0275prov=fe["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),fn=[{path:"",component:zt,children:[{path:"",redirectTo:"app",pathMatch:"full"},{path:"app",canActivate:[un],component:pn,children:[{path:":ownerName/:appName"}]}]}],mn=function(){function e(){}return e.\u0275mod=fe["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=fe["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},providers:[un],imports:[[be.i.forChild(fn)],be.i]}),e}(),bn=function(){function e(e,t,n,i,r,o){var c=this;this.actions$=e,this.appService=t,this.dbService=n,this.notificationService=i,this.connectionsService=r,this.store=o,this.loadConnections$=Object(a.d)((function(){return c.actions$.pipe(Object(a.e)(M),Object(z.a)((function(){return c.connectionsService.loadMyDbConnections().pipe(Object(W.a)((function(e){return P({connections:e})})),Object(U.a)((function(e){return c.notificationService.open({type:Z.f.DANGER,message:Object(p.i)(e)}),G.a})))})))})),this.saveAppContent$=Object(a.d)((function(){return c.actions$.pipe(Object(a.e)(I),Object(J.a)(c.store.select(ne),c.store.select(se)),Object(z.a)((function(e){var t=e[1].app,n=e[2];return Object(Q.a)((n||[]).map((function(e){return c.appService.saveAppLink({appName:t.appName,appOwnerName:t.ownerName,appContent:e})}))).pipe(Object(W.a)((function(){return c.notificationService.open({type:Z.f.SUCCESS,message:"Saved app contents"}),k()})),Object(U.a)((function(e){return c.notificationService.open({type:Z.f.DANGER,message:e.error||"Failed to save app content."}),Object(R.a)({type:"[Code Tabs] failed to save app contents"})})))})))})),this.saveDbTables$=Object(a.d)((function(){return c.actions$.pipe(Object(a.e)(E),Object(J.a)(c.store.select(le)),Object(z.a)((function(e){var t=e[1];return Object(Q.a)(Object.values(t).map((function(e){return e.structure.objectType===Z.g.Table?c.saveTable(e):c.saveView(e)}))).pipe(Object(W.a)((function(){return c.notificationService.open({type:Z.f.SUCCESS,message:"Saved tables"}),N({keys:Object.keys(t)})})),Object(U.a)((function(e){return c.notificationService.open({type:Z.f.DANGER,message:e.error||"Failed to save app content."}),Object(R.a)({type:"[Code Tabs] failed to save db tables"})})))})))}))}return e.prototype.saveTable=function(e){var t,n=this,i=e.dataChange,r=e.structureChange,o=e.connection,a=e.structure;return r?i?this.dbService.generateObject(o.connectionName,r).pipe(Object(z.a)((function(){return n.dbService.saveSqlObjectData(o.connectionName,r,{tableData:Object(p.o)(i.data),itemsToDelete:i.dataToDelete})}))):this.dbService.generateObject(o.connectionName,r):i?this.dbService.saveSqlObjectData(o.connectionName,r||a,{tableData:Object(p.o)(null===(t=i)||void 0===t?void 0:t.data),itemsToDelete:i.dataToDelete}):void 0},e.prototype.saveView=function(e){return this.dbService.generateObject(e.connection.connectionName,e.structure)},e.\u0275fac=function(t){return new(t||e)(fe["\u0275\u0275inject"](a.a),fe["\u0275\u0275inject"](X.a),fe["\u0275\u0275inject"](K.f),fe["\u0275\u0275inject"](K.e),fe["\u0275\u0275inject"](K.a),fe["\u0275\u0275inject"](o.h))},e.\u0275prov=fe["\u0275\u0275defineInjectable"]({token:e,factory:e.\u0275fac}),e}(),vn=n("/IbS"),hn=n("OaQ9"),gn=n("+MQa");n.d(t,"CodeModule",(function(){return jn}));var jn=function(){function e(){}return e.\u0275mod=fe["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=fe["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[r.CommonModule,i.FormsModule,p.c,hn.a,mn,vn.DatabaseManagerModule,s.WjNavModule,l.WjInputModule,gn.CustomAppModule,o.j.forRoot($,{metaReducers:q}),a.c.forRoot([me,bn]),c.a.instrument({maxAge:25,logOnly:d.a.production})]]}),e}()}}]);