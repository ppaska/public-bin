(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{"+8P3":function(e,t,n){"use strict";n.r(t),n.d(t,"WorksheetModule",(function(){return X}));var o=n("ofXK"),i=n("3Pt+"),r=n("44PX"),s=n("psEu"),c=n("ZOsW"),a=n("eY+I"),u=n("bqqp"),l=n("M0ag"),d=n("tyNb"),f=n("mrSG"),b=n("LRne"),h=n("vkgz"),p=n("eIep"),m=n("JIr8"),v=n("TwVa"),w=n("ZF+8"),g=n("iFvM"),k=n("nKjQ"),y=n("cuhF"),M=n("UShy"),S=n("fXoL"),j=n("Xn/w"),N=n("fQZA");function O(e,t){if(1&e&&(S.Tb(0,"div",2),S.Ec(1),S.Sb()),2&e){var n=t.$implicit;S.kc("title",n.description),S.Bb(1),S.Fc(n.worksheetName)}}var I=function(){function e(e,t,n){this.worksheetsService=e,this.router=t,this.route=n}return e.prototype.ngOnInit=function(){var e=this;this.route.params.subscribe((function(t){e.comparator(e.list.selectedItem,t)||e.list.selectItem(t)}))},e.prototype.onSelect=function(e){this.router.navigate(["/",e.ownerName,e.worksheetName])},e.prototype.comparator=function(e,t){return e&&t&&e.worksheetName===t.worksheetName&&e.ownerName===t.ownerName},e.\u0275fac=function(t){return new(t||e)(S.Nb(k.a),S.Nb(d.f),S.Nb(d.a))},e.\u0275cmp=S.Hb({type:e,selectors:[["app-worksheets-list"]],viewQuery:function(e,t){var n;1&e&&S.Ac(l.b,!0),2&e&&S.rc(n=S.cc())&&(t.list=n.first)},decls:4,vars:4,consts:[["orderBy","id","group","groupName",1,"d-flex","h-100","overflow-auto",3,"list","comparator","select"],["listView",""],[1,"m-1","pl-3",3,"title"]],template:function(e,t){1&e&&(S.Tb(0,"app-list-view",0,1),S.bc("select",(function(e){return t.onSelect(e)})),S.ec(2,"async"),S.Cc(3,O,2,2,"ng-template"),S.Sb()),2&e&&S.jc("list",S.fc(2,2,t.worksheetsService.worksheets$))("comparator",t.comparator)},directives:[N.a],pipes:[o.b],styles:[""]}),e}();function E(e,t){if(1&e){var n=S.Ub();S.Tb(0,"button",9),S.bc("click",(function(){return S.vc(n),S.dc().editWorksheet()})),S.Ob(1,"i",10),S.Ec(2," Edit Worksheet "),S.Sb()}if(2&e){var o=S.dc();S.jc("disabled",!o.worksheet)}}function T(e,t){if(1&e){var n=S.Ub();S.Tb(0,"ngx-dynamic-component",12),S.bc("eventHandlers",(function(e){return S.vc(n),S.dc(2).eventHandlers(e)})),S.Sb()}if(2&e){var o=S.dc(2);S.jc("uiModel",o.worksheet.uiModelXml)("dataModel",o.dataModel)}}function x(e,t){if(1&e&&(S.Rb(0),S.Cc(1,T,1,2,"ngx-dynamic-component",11),S.Qb()),2&e){var n=S.dc();S.Bb(1),S.jc("ngIf",!n.editMode)}}function W(e,t){1&e&&(S.Tb(0,"div",13),S.Tb(1,"div",14),S.Tb(2,"span",15),S.Ec(3,"Loading..."),S.Sb(),S.Sb(),S.Sb())}var C=function(){function e(e,t,n,o){this.route=e,this.worksheetsService=t,this.notificationService=n,this.dialogService=o,this.layoutConfig={icon:"assets/img/rc-logo-64x64.png",smIcon:"assets/img/rc-logo-36x36.png",appName:"worksheet"},this.editMode=!1,this.loading=!0,this.dataModel={}}return e.prototype.ngOnInit=function(){var e=this;this.worksheetsService.loadWorksheets().toPromise(),this.route.params.pipe(Object(h.a)((function(){e.worksheet=null,e.loading=!0})),Object(p.a)((function(t){return e.worksheetsService.getWorksheet(t.ownerName,t.worksheetName)})),Object(m.a)((function(t){return e.notificationService.open({type:v.NotificationType.DANGER,message:Object(g.l)(t)}),Object(b.a)(null)}))).subscribe((function(t){e.worksheet=t,e.loading=!1,e.setMenu()})),this.interpreter=Object(M.a)()},e.prototype.editWorksheet=function(){this.dialogService.open(y.a,{class:"modal-w-90 full-height"}).config=this.worksheet},e.prototype.eventHandlers=function(e){var t=e.eventName,n=e.parameters,o=void 0===n?null:n;return Object(f.b)(this,void 0,void 0,(function(){var e;return Object(f.e)(this,(function(n){switch(n.label){case 0:if(!this.interpreter)return[2];if(!this.interpreter.hasFunction(this.worksheet.scripts,t))return[3,6];this.loading=!0,n.label=1;case 1:return n.trys.push([1,3,5,6]),[4,this.interpreter.evaluate(this.worksheet.scripts,Object(f.a)({rootUIModel:this.worksheet.uiModel,dataModel:this.dataModel},o),t)];case 2:return n.sent(),[3,6];case 3:return e=n.sent(),[4,this.interpreter.evaluate('alert("'+e.message+'")')];case 4:return n.sent(),[3,6];case 5:return this.loading=!1,[7];case 6:return[2]}}))}))},e.prototype.setMenu=function(){var e=this;this.layoutConfig.menuItems=this.worksheet.isAdmin?this.editMode?[{label:"Run Mode",icon:"fa fa-play-circle-o",command:function(){e.editMode=!1,e.setMenu()}}]:[{label:"Design Mode",icon:"fa fa-paint-brush",command:function(){e.editMode=!0,e.setMenu()}}]:[]},e.\u0275fac=function(t){return new(t||e)(S.Nb(d.a),S.Nb(k.a),S.Nb(w.e),S.Nb(w.b))},e.\u0275cmp=S.Hb({type:e,selectors:[["app-worksheet-layout"]],decls:12,vars:4,consts:[[3,"config"],["title","",1,"mb-0","ml-0","top-sub-header","w-md-down-50"],["header","",1,"ml-auto","d-flex","mr-2"],["settings",""],["class","btn btn-light btn-sm mr-2 align-self-center","title","Edit Worksheet",3,"disabled","click",4,"ngIf"],["sidebar","",1,"h-100","w-100","py-2","d-flex","flex-column"],["content",""],[4,"ngIf"],["class","d-flex justify-content-center position-absolute align-items-center w-100 h-100 spinner flex-column",4,"ngIf"],["title","Edit Worksheet",1,"btn","btn-light","btn-sm","mr-2","align-self-center",3,"disabled","click"],[1,"fa","fa-edit"],[3,"uiModel","dataModel","eventHandlers",4,"ngIf"],[3,"uiModel","dataModel","eventHandlers"],[1,"d-flex","justify-content-center","position-absolute","align-items-center","w-100","h-100","spinner","flex-column"],["role","status",1,"spinner-border"],[1,"sr-only"]],template:function(e,t){1&e&&(S.Tb(0,"app-layout",0),S.Tb(1,"h2",1),S.Ec(2,"WORKSHEET "),S.Tb(3,"span"),S.Ec(4,"SYSTEMS"),S.Sb(),S.Sb(),S.Ob(5,"div",2),S.Rb(6,3),S.Cc(7,E,3,1,"button",4),S.Qb(),S.Ob(8,"app-worksheets-list",5),S.Rb(9,6),S.Cc(10,x,2,1,"ng-container",7),S.Cc(11,W,4,0,"div",8),S.Qb(),S.Sb()),2&e&&(S.jc("config",t.layoutConfig),S.Bb(7),S.jc("ngIf",t.worksheet&&t.worksheet.isAdmin&&t.editMode),S.Bb(3),S.jc("ngIf",t.worksheet),S.Bb(1),S.jc("ngIf",t.loading))},directives:[j.a,o.m,I,a.h],styles:[".btn[_ngcontent-%COMP%]   i.fa[_ngcontent-%COMP%]{width:13px}"]}),e}(),R=n("lJxs"),A=[{path:":worksheetName",component:C,canActivate:[function(){function e(e,t,n){this.router=e,this.worksheetsService=t,this.notificationService=n}return e.prototype.canActivate=function(e,t){var n=this,o=e.params;return this.worksheetsService.getWorksheet(o.ownerName,o.worksheetName).pipe(Object(R.a)((function(t){if(t)return e.data=Object(f.a)(Object(f.a)({},e.data),{guardedData:t}),!0;throw Error("Worksheet not available")})),Object(m.a)((function(e){return n.notificationService.open({type:v.NotificationType.DANGER,message:"You are not authorized to use this worksheet"}),n.router.navigate(["/login"],{queryParams:{returnUrl:t.url}}),Object(b.a)(!1)})))},e.\u0275fac=function(t){return new(t||e)(S.Xb(d.f),S.Xb(k.a),S.Xb(w.e))},e.\u0275prov=S.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()]}],H=function(){function e(){}return e.\u0275mod=S.Lb({type:e}),e.\u0275inj=S.Kb({factory:function(t){return new(t||e)},imports:[[d.i.forChild(A)],d.i]}),e}(),X=function(){function e(){}return e.\u0275mod=S.Lb({type:e}),e.\u0275inj=S.Kb({factory:function(t){return new(t||e)},imports:[[o.c,i.d,H,l.c,a.g,u.a,r.c.forRoot(),s.b.forRoot(),c.b]]}),e}()}}]);